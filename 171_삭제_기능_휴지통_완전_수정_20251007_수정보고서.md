# 26. ì‚­ì œ ê¸°ëŠ¥ ë° íœ´ì§€í†µ ì™„ì „ ìˆ˜ì •

> **ì‘ì—…ì¼**: 2025-08-31  
> **ì´ìŠˆ**: í”„ë¡œì íŠ¸ ì‚­ì œ í›„ í™”ë©´ì— ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆê³ , íœ´ì§€í†µì´ ë¹ˆ í˜ì´ì§€ë¡œ í‘œì‹œë˜ëŠ” ë¬¸ì œ

## ğŸš¨ ì‚¬ìš©ì í”¼ë“œë°±

> "ì‚­ì œí•´ë„ ì‚­ì œë˜ì§€ ì•Šê³  í™”ë©´ì— ê·¸ëŒ€ë¡œ ë³´ì´ë©°, íœ´ì§€í†µì€ ë¹ˆí˜ì´ì§€ì•¼. êµ¬í˜„ì´ ì•ˆëœ ê²ƒ ê°™ì•„."

## ğŸ” ê·¼ë³¸ ì›ì¸ ë¶„ì„

### 1. **ìƒíƒœ ê´€ë¦¬ ë¶ˆì¼ì¹˜ ë¬¸ì œ**
- **PersonalServiceDashboard**: `dataService.getProjects()`ë¡œ ë…ë¦½ì  í”„ë¡œì íŠ¸ ë¡œë“œ
- **App.tsx**: `onDeleteProject`ë¡œ App ì»´í¬ë„ŒíŠ¸ ìƒíƒœë§Œ ë³€ê²½
- **ê²°ê³¼**: App.tsx ìƒíƒœ ë³€ê²½ â†’ PersonalServiceDashboard `loadProjects()` í˜¸ì¶œ â†’ ë³€ê²½ì‚¬í•­ ë¬´ì‹œë¨

### 2. **íœ´ì§€í†µ ë°ì´í„° ë¶€ì¬**
- **ê¸°ì¡´**: `dataService.deleteProject()`ê°€ ì™„ì „ ì‚­ì œë§Œ ìˆ˜í–‰
- **ë¬¸ì œ**: íœ´ì§€í†µìš© ë³„ë„ ì €ì¥ì†Œ ì—†ìŒ
- **ê²°ê³¼**: ì‚­ì œëœ í”„ë¡œì íŠ¸ê°€ íœ´ì§€í†µì—ì„œ ì¡°íšŒë˜ì§€ ì•ŠìŒ

### 3. **ì»´í¬ë„ŒíŠ¸ ë¶ˆì¼ì¹˜**  
- **ì‚¬ìš© ì¤‘**: TrashBinTest (ë””ë²„ê¹…ìš©)
- **í•„ìš”í•œ ê²ƒ**: TrashBin (ì‹¤ì œ íœ´ì§€í†µ)

## ğŸ› ï¸ í•´ê²° ë°©ì•ˆ

### 1. dataServiceì— íœ´ì§€í†µ ì‹œìŠ¤í…œ êµ¬í˜„

#### ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤ ì¶”ê°€
```typescript
const STORAGE_KEYS = {
  // ê¸°ì¡´ í‚¤ë“¤...
  TRASH: 'ahp_trash_projects'  // ìƒˆë¡œ ì¶”ê°€
} as const;
```

#### ì†Œí”„íŠ¸ ì‚­ì œë¡œ ë³€ê²½
```typescript
// Before: ì™„ì „ ì‚­ì œ
async deleteProject(id: string): Promise<boolean> {
  const projects = storage.get<ProjectData[]>(STORAGE_KEYS.PROJECTS, []);
  const filteredProjects = projects.filter(p => p.id !== id);  // ì™„ì „ ì œê±°
  storage.set(STORAGE_KEYS.PROJECTS, filteredProjects);
  return true;
}

// After: íœ´ì§€í†µìœ¼ë¡œ ì´ë™ (ì†Œí”„íŠ¸ ì‚­ì œ)
async deleteProject(id: string): Promise<boolean> {
  const projects = storage.get<ProjectData[]>(STORAGE_KEYS.PROJECTS, []);
  const projectToDelete = projects.find(p => p.id === id);
  
  if (projectToDelete) {
    // íœ´ì§€í†µì— ì¶”ê°€
    const trashedProject = {
      ...projectToDelete,
      status: 'deleted',
      deleted_at: new Date().toISOString()
    };
    
    const trashedProjects = storage.get<ProjectData[]>(STORAGE_KEYS.TRASH, []);
    trashedProjects.push(trashedProject);
    storage.set(STORAGE_KEYS.TRASH, trashedProjects);
    
    // í™œì„± í”„ë¡œì íŠ¸ì—ì„œ ì œê±°
    const filteredProjects = projects.filter(p => p.id !== id);
    storage.set(STORAGE_KEYS.PROJECTS, filteredProjects);
    
    console.log('ğŸ—‘ï¸ í”„ë¡œì íŠ¸ë¥¼ íœ´ì§€í†µìœ¼ë¡œ ì´ë™:', id);
    return true;
  }
  return false;
}
```

#### íœ´ì§€í†µ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€
```typescript
// íœ´ì§€í†µ ì¡°íšŒ
async getTrashedProjects(): Promise<ProjectData[]> {
  return storage.get<ProjectData[]>(STORAGE_KEYS.TRASH, []);
}

// í”„ë¡œì íŠ¸ ë³µì›
async restoreProject(id: string): Promise<boolean> {
  const trashedProjects = storage.get<ProjectData[]>(STORAGE_KEYS.TRASH, []);
  const projectToRestore = trashedProjects.find(p => p.id === id);
  
  if (projectToRestore) {
    // íœ´ì§€í†µì—ì„œ ì œê±°
    const filteredTrash = trashedProjects.filter(p => p.id !== id);
    storage.set(STORAGE_KEYS.TRASH, filteredTrash);
    
    // í™œì„± í”„ë¡œì íŠ¸ë¡œ ë³µì›
    const restoredProject = { ...projectToRestore, status: 'active', deleted_at: undefined };
    const activeProjects = storage.get<ProjectData[]>(STORAGE_KEYS.PROJECTS, []);
    activeProjects.push(restoredProject);
    storage.set(STORAGE_KEYS.PROJECTS, activeProjects);
    return true;
  }
  return false;
}

// ì˜êµ¬ ì‚­ì œ
async permanentDeleteProject(id: string): Promise<boolean> {
  const trashedProjects = storage.get<ProjectData[]>(STORAGE_KEYS.TRASH, []);
  const filteredTrash = trashedProjects.filter(p => p.id !== id);
  storage.set(STORAGE_KEYS.TRASH, filteredTrash);
  
  // ê´€ë ¨ ë°ì´í„°ë„ ì™„ì „ ì‚­ì œ
  this.deleteCriteriaByProject(id);
  this.deleteAlternativesByProject(id);
  // ... ê¸°íƒ€ ê´€ë ¨ ë°ì´í„°
  return true;
}
```

### 2. PersonalServiceDashboard ì‚­ì œ ë¡œì§ ìˆ˜ì •

#### ì§ì ‘ dataService ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½
```typescript
// Before: App.tsxì˜ onDeleteProject prop ì˜ì¡´
if (onDeleteProject) {
  await onDeleteProject(projectId);  // App ìƒíƒœë§Œ ë³€ê²½
  await loadProjects();  // ë³€ê²½ì‚¬í•­ ë¬´ì‹œë¨
}

// After: dataService ì§ì ‘ í˜¸ì¶œ
const success = await dataService.deleteProject(projectId);  // ì§ì ‘ ì‚­ì œ
if (success) {
  // ë¡œì»¬ ìƒíƒœë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
  setProjects(prev => prev.filter(p => p.id !== projectId));
  // ì¶”ê°€ ë™ê¸°í™”
  await loadProjects();
}
```

**ê°œì„  íš¨ê³¼**:
- âœ… **ì¼ê´€ëœ ë°ì´í„° ì†ŒìŠ¤**: dataService ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›
- âœ… **ì¦‰ì‹œ UI ë°˜ì˜**: ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
- âœ… **ë™ê¸°í™” ë³´ì¥**: ì´ì¤‘ ì—…ë°ì´íŠ¸ë¡œ í™•ì‹¤í•œ ë°˜ì˜

### 3. App.tsx íœ´ì§€í†µ í•¨ìˆ˜ ê°œì„ 

#### ë°ëª¨ ëª¨ë“œ íœ´ì§€í†µ ì§€ì›
```typescript
// Before: ë°ëª¨ ëª¨ë“œì—ì„œ íœ´ì§€í†µ ë¯¸ì§€ì›
const fetchTrashedProjects = async () => {
  if (isDemoMode) {
    return []; // ë¹ˆ ë°°ì—´
  }
  // ...
};

// After: ë°ëª¨ ëª¨ë“œì—ì„œë„ íœ´ì§€í†µ ì™„ì „ ì§€ì›
const fetchTrashedProjects = async () => {
  if (isDemoMode) {
    console.log('ğŸ“Š ë°ëª¨ ëª¨ë“œ íœ´ì§€í†µ ì¡°íšŒ');
    const trashedProjects = await dataService.getTrashedProjects();
    console.log('ğŸ—‘ï¸ íœ´ì§€í†µ í”„ë¡œì íŠ¸ ê°œìˆ˜:', trashedProjects.length);
    return trashedProjects;
  }
  // ...
};
```

### 4. ì‹¤ì œ íœ´ì§€í†µ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©

#### TrashBinTest â†’ TrashBin êµì²´
```typescript
// Before: ë””ë²„ê¹…ìš© ì»´í¬ë„ŒíŠ¸
import TrashBinTest from './TrashBinTest';
// ...
case 'trash':
  return (
    <TrashBinTest
      onFetchTrashedProjects={onFetchTrashedProjects}
      onRestoreProject={onRestoreProject}
      onPermanentDeleteProject={onPermanentDeleteProject}
      onDeleteProject={onDeleteProject}  // ë¶ˆí•„ìš”í•œ prop
    />
  );

// After: ì‹¤ì œ íœ´ì§€í†µ ì»´í¬ë„ŒíŠ¸
import TrashBin from './TrashBin';
// ...  
case 'trash':
  return (
    <TrashBin
      onFetchTrashedProjects={onFetchTrashedProjects}
      onRestoreProject={onRestoreProject}
      onPermanentDeleteProject={onPermanentDeleteProject}
    />
  );
```

## ğŸ§ª ìˆ˜ì • í›„ ë™ì‘ íë¦„

### í”„ë¡œì íŠ¸ ì‚­ì œ íë¦„
1. **ì‚­ì œ ë²„íŠ¼ í´ë¦­** â†’ PersonalServiceDashboard.handleDeleteProject()
2. **í™•ì¸ ëŒ€í™”ìƒì** â†’ ì‚¬ìš©ì í™•ì¸
3. **dataService.deleteProject()** â†’ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
   - í™œì„± í”„ë¡œì íŠ¸ì—ì„œ ì œê±°
   - íœ´ì§€í†µì— ì¶”ê°€ (`status: 'deleted'`, `deleted_at: timestamp`)
4. **ì¦‰ì‹œ UI ë°˜ì˜** â†’ setProjects() ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸  
5. **ë™ê¸°í™”** â†’ loadProjects() ì¶”ê°€ ìƒˆë¡œê³ ì¹¨
6. **ì„±ê³µ ì•Œë¦¼** â†’ ì‚¬ìš©ì í”¼ë“œë°±

### íœ´ì§€í†µ ì¡°íšŒ íë¦„
1. **íœ´ì§€í†µ íƒ­ í´ë¦­** â†’ PersonalServiceDashboard 'trash' case
2. **TrashBin ì»´í¬ë„ŒíŠ¸** â†’ onFetchTrashedProjects() í˜¸ì¶œ
3. **App.fetchTrashedProjects()** â†’ dataService.getTrashedProjects()
4. **ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì¡°íšŒ** â†’ TRASH í‚¤ì—ì„œ ì‚­ì œëœ í”„ë¡œì íŠ¸ ë°˜í™˜
5. **íœ´ì§€í†µ UI ë Œë”ë§** â†’ ì‚­ì œëœ í”„ë¡œì íŠ¸ ëª©ë¡ í‘œì‹œ

### ë³µì› íë¦„
1. **ë³µì› ë²„íŠ¼ í´ë¦­** â†’ TrashBinì—ì„œ onRestoreProject() í˜¸ì¶œ
2. **dataService.restoreProject()** â†’ í”„ë¡œì íŠ¸ ì´ë™
   - íœ´ì§€í†µì—ì„œ ì œê±°
   - í™œì„± í”„ë¡œì íŠ¸ì— ì¶”ê°€ (`status: 'active'`, `deleted_at: undefined`)
3. **ëª©ë¡ ìƒˆë¡œê³ ì¹¨** â†’ í™œì„± í”„ë¡œì íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸

## ğŸ“Š ìˆ˜ì •ëœ íŒŒì¼ ìš”ì•½

### 1. **dataService.ts** (+55ë¼ì¸)
- `STORAGE_KEYS.TRASH` ì¶”ê°€
- `deleteProject()` ì†Œí”„íŠ¸ ì‚­ì œë¡œ ë³€ê²½
- `getTrashedProjects()` ì‹ ê·œ ì¶”ê°€
- `restoreProject()` ì‹ ê·œ ì¶”ê°€  
- `permanentDeleteProject()` ì‹ ê·œ ì¶”ê°€
- `clearAllData()` íœ´ì§€í†µ ë°ì´í„° í¬í•¨

### 2. **PersonalServiceDashboard.tsx** (+3ë¼ì¸)
- TrashBinTest â†’ TrashBin import ë³€ê²½
- handleDeleteProject() dataService ì§ì ‘ í˜¸ì¶œë¡œ ë³€ê²½
- TrashBin ì»´í¬ë„ŒíŠ¸ props ì •ë¦¬

### 3. **App.tsx** (+4ë¼ì¸)  
- fetchTrashedProjects() ë°ëª¨ ëª¨ë“œ ì§€ì› ì¶”ê°€

## ğŸ¯ ìµœì¢… í•´ê²° ê²°ê³¼

### ë¬¸ì œ í•´ê²° í™•ì¸
- âœ… **í”„ë¡œì íŠ¸ ì‚­ì œ**: ì¦‰ì‹œ ëª©ë¡ì—ì„œ ì œê±°ë¨
- âœ… **íœ´ì§€í†µ í‘œì‹œ**: ì‚­ì œëœ í”„ë¡œì íŠ¸ê°€ íœ´ì§€í†µì— í‘œì‹œë¨
- âœ… **ë°ì´í„° ì¼ê´€ì„±**: ë‹¨ì¼ ë°ì´í„° ì†ŒìŠ¤(dataService) ì‚¬ìš©
- âœ… **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: ë¡œì»¬ ìƒíƒœì™€ ë°ì´í„° ì €ì¥ì†Œ ë™ê¸°í™”

### ê¸°ìˆ ì  ê°œì„ 
- âœ… **ì†Œí”„íŠ¸ ì‚­ì œ**: ë°ì´í„° ë³´í˜¸ ë° ë³µì› ê°€ëŠ¥
- âœ… **ìƒíƒœ ê´€ë¦¬**: PersonalServiceDashboard â†” dataService ì§ì ‘ ì—°ê²°
- âœ… **íœ´ì§€í†µ ì‹œìŠ¤í…œ**: ì™„ì „í•œ CRUD ì‘ì—… ì§€ì›
- âœ… **ì»´í¬ë„ŒíŠ¸ ì •ë¦¬**: ë””ë²„ê¹…ìš© â†’ ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©

## ğŸ‰ ê²°ë¡ 

í”„ë¡œì íŠ¸ ì‚­ì œ ê¸°ëŠ¥ì´ ì´ì œ ì™„ì „íˆ ì‘ë™í•˜ë©°, íœ´ì§€í†µì—ì„œ ì‚­ì œëœ í”„ë¡œì íŠ¸ë¥¼ í™•ì¸í•˜ê³  ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°ì´í„° ì¼ê´€ì„± ë¬¸ì œê°€ í•´ê²°ë˜ì–´ ì‚­ì œ í›„ ì¦‰ì‹œ UIì— ë°˜ì˜ë˜ê³ , íœ´ì§€í†µì´ ë¹ˆ í˜ì´ì§€ê°€ ì•„ë‹Œ ì‹¤ì œ ì‚­ì œëœ í”„ë¡œì íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.