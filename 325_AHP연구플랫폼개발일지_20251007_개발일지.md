# AHP 연구 플랫폼 개발일지

## 📅 2025년 10월 3일

### 🎯 프로젝트 개요
- **프로젝트명**: AHP for Paper - 연구 논문을 위한 AHP 분석 플랫폼
- **프론트엔드**: React + TypeScript
- **백엔드**: Django REST Framework  
- **데이터베이스**: PostgreSQL
- **배포**: 
  - Frontend: GitHub Pages (https://aebonlee.github.io/ahp_app/)
  - Backend: Render (https://ahp-django-backend.onrender.com)

---

## 🔨 오늘의 주요 작업

### 1. 슈퍼 관리자 모드 버튼 가시성 문제 해결
#### 문제
- admin@ahp.com으로 로그인 시 슈퍼 관리자 토글 버튼이 보이지 않음
- 버튼 위치가 사용자 요구사항과 불일치 (상단 → 사이드바 하단으로 이동 필요)

#### 해결
- `Sidebar.tsx` 수정: 사이드바 푸터 영역에 토글 버튼 배치
- 이메일 기반 권한 체크 로직 구현
- 슈퍼 관리자 모드 토글 상태를 localStorage에 저장

### 2. 기준(Criteria) 생성 API 오류 수정
#### 문제
- "오류: 기준 생성에 실패했습니다: 서버가 올바른 응답을 반환하지 않았습니다. (500)"
- UUID 타입의 project_id를 parseInt()로 변환 시도하여 발생

#### 해결
- `api.ts`, `dataService_clean.ts` 수정
- UUID를 문자열로 유지하도록 타입 처리 수정
- Django CriteriaViewSet 엔드포인트 활용

### 3. localStorage 사용 완전 제거
#### 요구사항
- "로컬 스토리지 금지" - 모든 데이터는 PostgreSQL DB에 저장

#### 해결
- `dataService_clean.ts`에서 localStorage fallback 코드 제거
- 100% PostgreSQL 기반 데이터 저장 구현
- 오프라인 모드 제거

### 4. 대시보드 역할별 분리
#### 문제
- 개인 관리자와 슈퍼 관리자의 대시보드가 혼용됨
- 3가지 진입점(로고, 대시보드 버튼, 사이드바)의 라우팅 불일치

#### 해결
##### App.tsx
- 슈퍼 모드 체크 로직 추가
- 조건부 컴포넌트 렌더링 구현

##### Header.tsx
- 로고 클릭: 역할별 적절한 대시보드로 라우팅
- 대시보드 버튼: 슈퍼/개인 모드 구분

##### Sidebar.tsx  
- "내 대시보드" 메뉴: 역할별 라우팅 구현

##### PersonalServiceDashboard.tsx
- useEffect로 슈퍼 관리자 모드 자동 리다이렉트
- renderMenuContent에 모드 체크 로직 추가

### 5. 평가자 전용 대시보드 간소화
#### 요구사항
- 평가자는 초대받은 링크로만 평가 수행
- 복잡한 기능 불필요

#### 구현
- `EvaluatorOnlyDashboard.tsx` 전면 재작성
- 초대 코드 입력 중심의 심플한 UI
- 도움말과 안내 메시지 포함

---

## 🧪 테스트 결과

### ✅ 성공한 테스트
1. **GitHub 배포**
   - main 브랜치 푸시 완료
   - gh-pages 자동 배포 성공

2. **백엔드 연결**
   - Django REST API 정상 작동
   - CORS 설정 확인
   - 응답 시간: ~500ms

3. **PostgreSQL 데이터베이스**
   - 프로젝트 CRUD 작동 확인
   - 현재 저장된 프로젝트: 3개

### ⚠️ 미해결 이슈
1. **Criteria API 500 오류**
   - POST /api/service/projects/criteria/ 엔드포인트
   - 백엔드 모델 관계 설정 확인 필요

---

## 📊 현재 시스템 상태

### 데이터베이스
```
총 프로젝트: 3개
├─ Test Project (f60bf937-c5f5-4eb1-8079-c8c7d9eb94d6)
├─ 훈련교사의 역량 (f20ea87b-effc-4f27-b6e1-67fcc032e102)
└─ Test Project 1759464801718 (새로 생성)
```

### 사용자 역할 구조
```
super_admin (슈퍼 관리자)
├─ 슈퍼 관리자 모드 → SuperAdminDashboard
└─ 개인 서비스 모드 → PersonalServiceDashboard

service_admin (서비스 관리자)
└─ PersonalServiceDashboard (관리자 뷰)

service_user (일반 사용자)  
└─ PersonalUserDashboard

evaluator (평가자)
└─ EvaluatorOnlyDashboard (초대 코드 입력)
```

### 주요 라우팅 경로
| 진입점 | 슈퍼 관리자 모드 | 개인 서비스 모드 |
|--------|-----------------|-----------------|
| 로고 클릭 | super-admin-dashboard | personal-service |
| 대시보드 버튼 | super-admin-dashboard | personal-service |
| 사이드바 "내 대시보드" | super-admin-dashboard | personal-service |

---

## 🔧 기술 스택 상세

### Frontend
- **React** 18.2.0
- **TypeScript** 4.9.5
- **TailwindCSS** 3.3.0
- **React Router** 6.x
- **Axios** (API 통신)

### Backend
- **Django** 4.2
- **Django REST Framework**
- **PostgreSQL** 14
- **django-cors-headers**

### 배포 인프라
- **Frontend**: GitHub Pages
- **Backend**: Render.com
- **Database**: Render PostgreSQL

---

## 📝 주요 파일 변경 내역

### 수정된 파일
1. `src/App.tsx` - 슈퍼 모드 체크 및 조건부 렌더링
2. `src/components/layout/Header.tsx` - 로고/대시보드 버튼 라우팅
3. `src/components/layout/Sidebar.tsx` - 슈퍼 관리자 토글 버튼 위치 변경
4. `src/components/admin/PersonalServiceDashboard.tsx` - 슈퍼 모드 리다이렉트
5. `src/components/evaluator/EvaluatorOnlyDashboard.tsx` - 전면 재작성
6. `src/services/api.ts` - UUID 처리 수정
7. `src/services/dataService_clean.ts` - localStorage 제거

### 새로 생성된 파일
1. `test-db-connection.js` - DB 연결 테스트 스크립트
2. `db-test-results.md` - 테스트 결과 보고서
3. `개발일지_20251003.md` - 개발 진행 상황 문서

---

## 🎯 다음 작업 계획

### 긴급
1. Criteria API 500 오류 수정 (백엔드)
2. 사용자 인증 토큰 만료 처리

### 단기 (1주일 내)
1. 평가자 초대 링크 시스템 구현
2. 쌍대비교 평가 인터페이스 완성
3. 일관성 검증 로직 구현

### 중기 (2주일 내)
1. 결과 분석 대시보드 구현
2. PDF/Excel 리포트 생성 기능
3. 실시간 협업 기능 추가

### 장기 (1개월 내)
1. AI 기반 논문 작성 도우미
2. 다국어 지원 (영어, 중국어)
3. 모바일 반응형 최적화

---

## 💡 개선 아이디어

1. **성능 최적화**
   - React.lazy()를 활용한 코드 스플리팅
   - 이미지 최적화 및 CDN 활용
   - API 응답 캐싱 전략

2. **사용자 경험**
   - 온보딩 튜토리얼 추가
   - 단축키 지원
   - 다크 모드 개선

3. **보안 강화**
   - JWT 토큰 갱신 로직
   - API Rate Limiting
   - SQL Injection 방지

---

## 📞 연락처 및 리소스

- **GitHub Frontend**: https://github.com/aebonlee/ahp_app
- **GitHub Backend**: https://github.com/aebonlee/ahp-django-service
- **Production URL**: https://aebonlee.github.io/ahp_app/
- **API Documentation**: https://ahp-django-backend.onrender.com/api/docs/

---

## ✍️ 작성자 노트

오늘은 주로 사용자 인터페이스 개선과 역할별 대시보드 분리 작업에 집중했습니다. 
슈퍼 관리자 모드와 개인 서비스 모드의 명확한 구분이 이루어졌고, 
평가자를 위한 간소화된 인터페이스도 구현했습니다.

백엔드와의 연동도 대부분 정상 작동하나, Criteria API의 500 오류는 
백엔드 팀과 협의하여 해결해야 할 것으로 보입니다.

localStorage 의존성을 완전히 제거하고 PostgreSQL 기반으로 전환한 것은 
데이터 일관성과 보안 측면에서 큰 개선입니다.

내일은 평가자 초대 시스템과 실제 평가 인터페이스 구현에 집중할 예정입니다.

---

*마지막 업데이트: 2025년 10월 3일 오후 1:30*