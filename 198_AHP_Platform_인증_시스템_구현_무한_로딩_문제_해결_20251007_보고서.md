# AHP Platform ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ë° ë¬´í•œ ë¡œë”© ë¬¸ì œ í•´ê²° ë³´ê³ ì„œ

## ğŸ“… ì‘ì—… ì¼ì: 2025ë…„ 9ì›” 1ì¼

## ğŸ¯ ì‘ì—… ëª©í‘œ
1. GitHub Pages ë¬´í•œ ë¡œë”© ë¬¸ì œ í•´ê²°
2. ë°±ì—”ë“œ ì¸ì¦ ì‹œìŠ¤í…œ ì™„ì „ êµ¬í˜„
3. í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ì—°ë™ ì™„ì„±
4. ê°œì¸ ì„œë¹„ìŠ¤ í˜ì´ì§€ ì ‘ê·¼ ë¬¸ì œ í•´ê²°

## ğŸ” ë¬¸ì œ ì§„ë‹¨

### 1. ë¬´í•œ ë¡œë”© ë¬¸ì œ ì›ì¸
```javascript
// ë¬¸ì œê°€ ëœ ì½”ë“œ
useEffect(() => {
  checkBackendAndInitialize();
}, [backendStatus]); // backendStatusê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì¬ì‹¤í–‰
```
- `backendStatus`ê°€ ì˜ì¡´ì„± ë°°ì—´ì— í¬í•¨ë˜ì–´ ìƒíƒœ ë³€ê²½ ì‹œë§ˆë‹¤ ì´ˆê¸°í™” í•¨ìˆ˜ ì¬ì‹¤í–‰
- ë¬´í•œ ë£¨í”„ ë°œìƒìœ¼ë¡œ ì•±ì´ ë¡œë”© ìƒíƒœì—ì„œ ë²—ì–´ë‚˜ì§€ ëª»í•¨

### 2. GitHub Pages ë¼ìš°íŒ… ë¬¸ì œ
- ì˜ëª»ëœ ê²½ë¡œ: `/ahp-research-platform/`
- ì˜¬ë°”ë¥¸ ê²½ë¡œ: `/ahp-platform/`
- 404.html, GitHub Actions ë“± ì—¬ëŸ¬ íŒŒì¼ì—ì„œ ì˜ëª»ëœ ê²½ë¡œ ì°¸ì¡°

### 3. CORS ì„¤ì • ë¬¸ì œ
```javascript
// ì˜ëª»ëœ CORS ì„¤ì •
'https://aebonlee.github.io/ahp-platform' // ê²½ë¡œ í¬í•¨

// ì˜¬ë°”ë¥¸ CORS ì„¤ì •
'https://aebonlee.github.io' // ë„ë©”ì¸ë§Œ
```

### 4. TypeScript íƒ€ì… ë¶ˆì¼ì¹˜
- ë°±ì—”ë“œ: `id: number` ë°˜í™˜
- í”„ë¡ íŠ¸ì—”ë“œ: `id: string` ê¸°ëŒ€
- ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ íƒ€ì… ì—ëŸ¬ ë°œìƒ

## âœ… í•´ê²° ë°©ì•ˆ ë° êµ¬í˜„

### 1. ë¬´í•œ ë¡œë”© í•´ê²°
```javascript
// ìˆ˜ì •ëœ ì½”ë“œ
// ì´ˆê¸° ë¡œë”© (í•œ ë²ˆë§Œ ì‹¤í–‰)
useEffect(() => {
  checkBackendAndInitialize();
}, []); // ë¹ˆ ì˜ì¡´ì„± ë°°ì—´

// isNavigationReady ê¸°ë³¸ê°’ ë³€ê²½
const [isNavigationReady, setIsNavigationReady] = useState(true);

// checkBackendAndInitialize í•¨ìˆ˜ ê°œì„ 
const checkBackendAndInitialize = async () => {
  try {
    // ë°±ì—”ë“œ ì—°ê²° ì‹œë„
    const response = await fetch(`${API_BASE_URL}/api/health`);
    if (response.ok) {
      setBackendStatus('available');
      validateSession();
    }
  } catch (error) {
    setBackendStatus('unavailable');
  }
  // finally ë¸”ë¡ ì œê±° - í•­ìƒ ì•± ì‚¬ìš© ê°€ëŠ¥
};
```

### 2. ë¼ìš°íŒ… ê²½ë¡œ í†µì¼
```javascript
// 404.html ìˆ˜ì •
if (!currentUrl.includes('/ahp-platform/')) {
  const newUrl = window.location.origin + '/ahp-platform/' + searchParams + hash;
  window.location.replace(newUrl);
}

// GitHub Actions ìˆ˜ì •
env:
  PUBLIC_URL: /ahp-platform
```

### 3. ë°±ì—”ë“œ ì¸ì¦ ì‹œìŠ¤í…œ
```javascript
// backend/src/routes/auth.ts
router.post('/login', loginValidation, async (req, res) => {
  const { email, password } = req.body;
  
  // ì‚¬ìš©ì ì¡°íšŒ
  const user = await UserService.findByEmail(email);
  
  // íŒ¨ìŠ¤ì›Œë“œ ê²€ì¦
  const isValidPassword = await comparePassword(password, user.password_hash);
  
  // JWT í† í° ìƒì„±
  const token = generateToken(user);
  const refreshToken = generateRefreshToken(user);
  
  // ì¿ í‚¤ ì„¤ì •
  res.cookie('token', token, {
    httpOnly: true,
    secure: true,
    sameSite: 'none',
    maxAge: 86400000 // 24ì‹œê°„
  });
  
  res.json({ message: 'Login successful', user });
});
```

### 4. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
```javascript
// backend/src/database/connection.ts
// í…Œì´ë¸” ìƒì„±
await query(`
  CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    role VARCHAR(20) CHECK(role IN ('admin', 'evaluator')) NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
  )
`);

// ê¸°ë³¸ ê³„ì • ìƒì„±
const hashedPassword = await bcrypt.hash('password123', 10);
await query(`
  INSERT INTO users (email, password_hash, first_name, last_name, role, is_active) 
  VALUES ($1, $2, $3, $4, $5, $6)
  ON CONFLICT (email) DO NOTHING
`, ['admin@ahp-system.com', hashedPassword, 'Admin', 'User', 'admin', true]);

// í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„±
const testHashedPassword = await bcrypt.hash('tester@', 10);
await query(`
  INSERT INTO users (email, password_hash, first_name, last_name, role, is_active) 
  VALUES ($1, $2, $3, $4, $5, $6)
  ON CONFLICT (email) DO UPDATE SET
    password_hash = $2,
    first_name = $3,
    last_name = $4,
    role = $5,
    is_active = $6
`, ['test@ahp.com', testHashedPassword, 'Test', 'Admin', 'admin', true]);
```

### 5. TypeScript íƒ€ì… í†µì¼
```typescript
// ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ user ID íƒ€ì… ìˆ˜ì •
interface UserProps {
  user: {
    id: string | number; // ë°±ì—”ë“œëŠ” numberë¡œ ë³´ëƒ„
    first_name: string;
    last_name: string;
    email: string;
    role: 'super_admin' | 'admin' | 'evaluator';
  };
}

// ID ì‚¬ìš© ì‹œ ë¬¸ìì—´ ë³€í™˜
id: String(user.id)
```

### 6. CORS ì„¤ì • ìµœì í™”
```javascript
// backend/src/index.ts
const allowedOrigins = [
  'http://localhost:3000',
  'https://aebonlee.github.io', // ë„ë©”ì¸ë§Œ (ê²½ë¡œ ì œì™¸)
  'https://ahp-platform.onrender.com'
];

app.use(cors({
  origin: function (origin, callback) {
    if (!origin || allowedOrigins.indexOf(origin) !== -1) {
      return callback(null, true);
    }
    callback(new Error('Not allowed by CORS'));
  },
  credentials: true, // ì¿ í‚¤ ì „ì†¡ í—ˆìš©
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With']
}));
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼

### 1. ë¡œê·¸ì¸ API í…ŒìŠ¤íŠ¸
```bash
curl -X POST https://ahp-platform.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@ahp-system.com","password":"password123"}' \
  -c cookies.txt -v

# ì‘ë‹µ
{
  "message": "Login successful",
  "user": {
    "id": 1,
    "email": "admin@ahp-system.com",
    "first_name": "Admin",
    "last_name": "User",
    "role": "admin",
    "is_active": true
  }
}
```

### 2. ì¿ í‚¤ ì„¤ì • í™•ì¸
```
Set-Cookie: token=eyJhbGciOiJIUzI1NiI...; HttpOnly; Secure; SameSite=None
Set-Cookie: refreshToken=eyJhbGciOiJIUzI1NiI...; HttpOnly; Secure; SameSite=None
```

## ğŸš€ ë°°í¬ ì •ë³´

### GitHub Pages (Frontend)
- URL: https://aebonlee.github.io/ahp-platform/
- ë¸Œëœì¹˜: gh-pages
- ë°°í¬ ëª…ë ¹: `npm run deploy`

### Render.com (Backend)
- URL: https://ahp-platform.onrender.com
- í”Œëœ: Starter ($7/month)
- ìë™ ë°°í¬: GitHub main ë¸Œëœì¹˜ push ì‹œ

### PostgreSQL Database
- í˜¸ìŠ¤íŠ¸: Render.com
- Service ID: dpg-d2q8l5qdbo4c73bt3780-a
- í”Œëœ: Basic-256mb ($7/month)

## ğŸ“ ì‚¬ìš© ê°€ëŠ¥í•œ ê³„ì •

| ì´ë©”ì¼ | íŒ¨ìŠ¤ì›Œë“œ | ì—­í•  | ì„¤ëª… |
|--------|----------|------|------|
| admin@ahp-system.com | password123 | admin | ê¸°ë³¸ ê´€ë¦¬ì ê³„ì • |
| test@ahp.com | tester@ | admin | í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì • |

## ğŸ”§ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### Frontend
- `src/App.tsx`: ë¼ìš°íŒ… ë¡œì§ ë° useEffect ì˜ì¡´ì„± ìˆ˜ì •
- `src/components/layout/Layout.tsx`: user ID íƒ€ì… ìˆ˜ì •
- `src/components/admin/PersonalServiceDashboard.tsx`: user props íƒ€ì… ìˆ˜ì •
- `src/components/settings/PersonalSettings.tsx`: user props íƒ€ì… ìˆ˜ì •
- `src/components/admin/UsageManagement.tsx`: user props íƒ€ì… ìˆ˜ì •
- `public/404.html`: GitHub Pages SPA ë¼ìš°íŒ… ìˆ˜ì •
- `build/404.html`: ë¹Œë“œëœ 404 í˜ì´ì§€ ìˆ˜ì •

### Backend
- `backend/src/index.ts`: CORS ì„¤ì • ìˆ˜ì •
- `backend/src/routes/auth.ts`: ë¡œê·¸ì¸/íšŒì›ê°€ì… API êµ¬í˜„
- `backend/src/database/connection.ts`: ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ë° ê³„ì • ìƒì„±
- `backend/src/services/userService.ts`: ì‚¬ìš©ì ê´€ë¦¬ ì„œë¹„ìŠ¤
- `backend/src/utils/auth.ts`: JWT í† í° ë° íŒ¨ìŠ¤ì›Œë“œ ìœ í‹¸ë¦¬í‹°
- `backend/src/middleware/auth.ts`: ì¸ì¦ ë¯¸ë“¤ì›¨ì–´

### ì„¤ì • íŒŒì¼
- `.github/workflows/gh-pages-deploy.yml`: PUBLIC_URL ìˆ˜ì •
- `404.html`: ë£¨íŠ¸ ë””ë ‰í† ë¦¬ 404 í˜ì´ì§€ ìˆ˜ì •
- `render.yaml`: Render ë°°í¬ ì„¤ì • (plan: starter)

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **ë³´ì•ˆ ê°•í™”**
   - Rate limiting êµ¬í˜„
   - CSRF í† í° ì¶”ê°€
   - SQL Injection ë°©ì§€ ê°•í™”

2. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **
   - ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ìƒì„¸ ì—ëŸ¬ ë©”ì‹œì§€
   - ì„¸ì…˜ ë§Œë£Œ ì•Œë¦¼
   - ìë™ ë¡œê·¸ì¸ ê¸°ëŠ¥

3. **ê´€ë¦¬ ê¸°ëŠ¥ í™•ì¥**
   - ì‚¬ìš©ì ê´€ë¦¬ CRUD
   - ê¶Œí•œ ì„¸ë¶„í™”
   - ê°ì‚¬ ë¡œê·¸

## ğŸ“š ì°¸ê³  ìë£Œ
- [JWT Authentication Best Practices](https://jwt.io/introduction/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [GitHub Pages SPA Configuration](https://create-react-app.dev/docs/deployment/#github-pages)
- [Render.com Deployment Guide](https://render.com/docs)

---

*ì‘ì„±ì: Claude Code Assistant*  
*ë‚ ì§œ: 2025ë…„ 9ì›” 1ì¼*  
*ë²„ì „: v2.2.0*