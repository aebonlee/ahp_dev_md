# ì‹¤ì œ ë°°í¬ í™˜ê²½ API ì„¤ì • ìˆ˜ì • ê°œë°œ ì¼ì§€

**ì‘ì—… ì¼ì:** 2025-08-30  
**ì»¤ë°‹ í•´ì‹œ:** 081c51c  
**ì‘ì—… ì‹œê°„:** ì•½ 20ë¶„  

## ğŸš¨ ê¸´ê¸‰ ë¬¸ì œ ë°œìƒ

**ì‚¬ìš©ì ë³´ê³ :** "/api/users/profile:1 Failed to load resource: the server responded with a status of 405 () ì €ì¥ë„ ì‹¤íŒ¨ì•¼. ê°œì¸ ì„¤ì • ì €ì¥ì´ ì•ˆë˜"

## ğŸ” ë¬¸ì œ ë¶„ì„

### 405 Method Not Allowed ì—ëŸ¬ ì›ì¸
```
HTTP 405 - Method Not Allowed
- PersonalSettingsì—ì„œ PUT ìš”ì²­ì„ ë³´ëƒˆì§€ë§Œ ì„œë²„ì—ì„œ ë°›ì§€ ëª»í•¨
- API ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ ë˜ëŠ” CORS ì„¤ì • ë¬¸ì œ ì˜ì‹¬
```

### ë°°í¬ í™˜ê²½ vs ë¡œì»¬ ê°œë°œ í™˜ê²½ ì°¨ì´ì 
```typescript
// ê°œë°œ í™˜ê²½ (ì˜ëª»ëœ ì ‘ê·¼)
fetch('/api/users/profile')  // ìƒëŒ€ ê²½ë¡œ
â†’ http://localhost:3000/api/users/profile (í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„)

// ì‹¤ì œ ë°°í¬ í™˜ê²½ (ì˜¬ë°”ë¥¸ ì ‘ê·¼)  
fetch(`${API_BASE_URL}/api/users/profile`)  // ì ˆëŒ€ ê²½ë¡œ
â†’ https://ahp-forpaper.onrender.com/api/users/profile (ë°±ì—”ë“œ ì„œë²„)
```

## ğŸ› ï¸ í•´ê²° ê³¼ì •

### 1. API ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ í™•ì¸

**backend/src/index.ts (lines 103-116):**
```typescript
app.use('/api/auth', authRoutes);
app.use('/api/users', userRoutes);  // âœ… /api/users ê²½ë¡œ ì •ìƒ ë“±ë¡
app.use('/api/projects', projectRoutes);
// ... ê¸°íƒ€ ë¼ìš°í„°ë“¤
```

**backend/src/routes/users.ts (lines 88-119):**
```typescript
// âœ… PUT /api/users/profile ì—”ë“œí¬ì¸íŠ¸ ì¡´ì¬ í™•ì¸
router.put('/profile',
  authenticateToken,
  [
    body('first_name').optional().trim().isLength({ min: 1, max: 50 }),
    body('last_name').optional().trim().isLength({ min: 1, max: 50 })
  ],
  async (req: AuthenticatedRequest, res: Response) => {
    const userId = req.user.id;
    const user = await UserService.updateUser(userId, req.body);
    // ...
  }
);
```

### 2. CORS ì„¤ì • ê²€ì¦

**backend/src/index.ts (lines 49-68):**
```typescript
app.use(cors({
  origin: function (origin, callback) {
    const allowedOrigins = [
      'http://localhost:3000',
      'https://aebonlee.github.io',  // âœ… GitHub Pages í—ˆìš©
      'https://ahp-frontend-render.onrender.com',
      'https://ahp-forpaper.onrender.com'
    ];
    // ...
  },
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],  // âœ… PUT í—ˆìš©
  allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With']
}));
```

### 3. PersonalSettings API í˜¸ì¶œ ìˆ˜ì •

**ë¬¸ì œ ë°œê²¬:**
```typescript
// âŒ ì˜ëª»ëœ API í˜¸ì¶œ (ìƒëŒ€ ê²½ë¡œ)
const response = await fetch('/api/users/profile', {
```

**í•´ê²°ì±… êµ¬í˜„:**
```typescript
// âœ… ì˜¬ë°”ë¥¸ API í˜¸ì¶œ (API_BASE_URL ì‚¬ìš©)
import { API_BASE_URL } from '../../config/api';

const response = await fetch(`${API_BASE_URL}/api/users/profile`, {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    first_name: settings.profile.firstName,
    last_name: settings.profile.lastName
  })
});
```

## ğŸŒ ë°°í¬ í™˜ê²½ API ì„¤ì •

### API_BASE_URL í™˜ê²½ë³„ ì„¤ì •
**src/config/api.ts (lines 2-5):**
```typescript
export const API_BASE_URL = process.env.REACT_APP_API_URL || 
  (process.env.NODE_ENV === 'development' 
    ? 'http://localhost:5000'     // ê°œë°œ í™˜ê²½
    : 'https://ahp-forpaper.onrender.com');  // í”„ë¡œë•ì…˜ í™˜ê²½
```

### ì‹¤ì œ ë°°í¬ ì‹œ API í˜¸ì¶œ íë¦„
```
GitHub Pages í”„ë¡ íŠ¸ì—”ë“œ
(https://aebonlee.github.io/ahp-research-platform)
    â†“
PersonalSettings.tsx
    â†“
API_BASE_URL = 'https://ahp-forpaper.onrender.com'
    â†“
PUT https://ahp-forpaper.onrender.com/api/users/profile
    â†“
Render.com PostgreSQL Database ì €ì¥
```

## ğŸ§¹ ì½”ë“œ ì •ë¦¬ ì‘ì—…

### 1. ì„ì‹œ í…ŒìŠ¤íŠ¸ íŒŒì¼ ì œê±°
```bash
rm test-server.js
rm backend/create_test_user.js  
rm backend/.env
```

### 2. ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì œê±°
**backend/src/services/userService.ts:**
- ì„ì‹œ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ë¡œì§ ì™„ì „ ì œê±°
- ì›ë³¸ DB ì¿¼ë¦¬ ë¡œì§ìœ¼ë¡œ ë³µì›

### 3. í”„ë¡œë•ì…˜ ë¹Œë“œ ìµœì í™”
```bash
npm run build:frontend
# âœ… 345.12 kB ë²ˆë“¤ í¬ê¸° (ìµœì í™”ë¨)
# âœ… API_BASE_URL ì •ìƒ ì ìš©
```

## ğŸ”„ ì™„ì „í•œ ë°ì´í„° íë¦„ (í”„ë¡œë•ì…˜)

### GitHub Pages â†’ Render.com í†µì‹ 
```
ì‚¬ìš©ì ì´ë¦„ ë³€ê²½
    â†“
PersonalSettings.saveSettings()
    â†“
1. API í˜¸ì¶œ: PUT ${API_BASE_URL}/api/users/profile
2. ì¸ì¦: JWT Bearer í† í°
3. CORS: aebonlee.github.io í—ˆìš©
    â†“
Render.com ë°±ì—”ë“œ ì²˜ë¦¬
    â†“
PostgreSQL DB ì—…ë°ì´íŠ¸
    â†“
ì‘ë‹µ: ì—…ë°ì´íŠ¸ëœ ì‚¬ìš©ì ì •ë³´
    â†“
í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸ âœ…
```

## ğŸš€ ë°°í¬ ìƒíƒœ í™•ì¸

### GitHub Pages ë°°í¬
- **URL**: https://aebonlee.github.io/ahp-research-platform
- **ë¹Œë“œ**: homepage ì„¤ì •ìœ¼ë¡œ /ahp-research-platform/ ê²½ë¡œ ì§€ì›
- **ìƒíƒœ**: ìµœì‹  ì»¤ë°‹ 081c51c ìë™ ë°°í¬

### Render.com ë°±ì—”ë“œ ë°°í¬  
- **URL**: https://ahp-forpaper.onrender.com
- **API**: PUT /api/users/profile ì—”ë“œí¬ì¸íŠ¸ í™œì„±
- **DB**: PostgreSQL ì—°ê²° ë° ì‚¬ìš©ì ì •ë³´ ì €ì¥

## ğŸ”§ ê¸°ìˆ ì  êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### API ì„¤ì • ê³„ì¸µ êµ¬ì¡°
```
1. í™˜ê²½ ë³€ìˆ˜: REACT_APP_API_URL (ìµœìš°ì„ )
2. NODE_ENV ê¸°ë°˜: development vs production
3. ê¸°ë³¸ê°’: render.com í”„ë¡œë•ì…˜ URL
```

### CORS ë³´ì•ˆ ì„¤ì •
```typescript
allowedOrigins: [
  'https://aebonlee.github.io',  // GitHub Pages
  'https://ahp-forpaper.onrender.com'  // Render.com
]
```

### JWT ì¸ì¦ íë¦„
```typescript
1. ë¡œê·¸ì¸: ì‚¬ìš©ìê°€ render.comì—ì„œ í† í° ë°œê¸‰
2. ì €ì¥: localStorageì— í† í° ë³´ê´€
3. ì¸ì¦: API í˜¸ì¶œ ì‹œ Bearer í† í° ì „ì†¡
4. ê²€ì¦: render.comì—ì„œ JWT í† í° ê²€ì¦
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (í”„ë¡œë•ì…˜)

### ì‹¤ì œ ë°°í¬ í™˜ê²½ í…ŒìŠ¤íŠ¸
1. **ì ‘ì†**: https://aebonlee.github.io/ahp-research-platform
2. **ë¡œê·¸ì¸**: test@ahp.com / password
3. **ê°œì¸ì„¤ì •**: ì´ë¦„ ë³€ê²½ í›„ ì €ì¥
4. **í™•ì¸**: Consoleì—ì„œ API í˜¸ì¶œ ì„±ê³µ ë¡œê·¸ í™•ì¸
5. **F5 í…ŒìŠ¤íŠ¸**: ìƒˆë¡œê³ ì¹¨ í›„ ë³€ê²½ì‚¬í•­ ìœ ì§€ í™•ì¸

### API ì—”ë“œí¬ì¸íŠ¸ ì§ì ‘ í…ŒìŠ¤íŠ¸
```bash
# ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
curl -X POST "https://ahp-forpaper.onrender.com/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"test@ahp.com","password":"password"}'

# í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸  
curl -X PUT "https://ahp-forpaper.onrender.com/api/users/profile" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{"first_name":"ë³€ê²½ëœì´ë¦„","last_name":"ë³€ê²½ëœì„±"}'
```

## ğŸ“Š ì„±ëŠ¥ ë° ë³´ì•ˆ

### API ì‘ë‹µ ì‹œê°„ ìµœì í™”
- **Render.com**: ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ìë™ ìŠ¤ì¼€ì¼ë§
- **PostgreSQL**: ì¸ë±ìŠ¤ ìµœì í™”ë¡œ ë¹ ë¥¸ ì‚¬ìš©ì ì¡°íšŒ
- **JWT í† í°**: 7ì¼ ë§Œë£Œ ì„¤ì •ìœ¼ë¡œ ë³´ì•ˆê³¼ í¸ì˜ì„± ê· í˜•

### ë³´ì•ˆ ê°•í™” ìš”ì†Œ
```typescript
1. CORS Origin ì œí•œ: í—ˆìš©ëœ ë„ë©”ì¸ë§Œ ì ‘ê·¼
2. JWT ì¸ì¦: ì„œë²„ ì‚¬ì´ë“œ í† í° ê²€ì¦
3. Input Validation: express-validatorë¡œ ë°ì´í„° ê²€ì¦
4. HTTPS ê°•ì œ: Render.com ìë™ SSL ì¸ì¦ì„œ
```

## ğŸ¯ ìµœì¢… ê²°ê³¼

### ë¬¸ì œ í•´ê²° ìƒíƒœ
- âœ… **405 ì—ëŸ¬ í•´ê²°**: ì˜¬ë°”ë¥¸ API ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ ì‚¬ìš©
- âœ… **ì‹¤ì œ ë°°í¬ í™˜ê²½**: GitHub Pages â†” Render.com ì •ìƒ ì—°ë™
- âœ… **DB ì €ì¥ ê¸°ëŠ¥**: ê°œì¸ì„¤ì • ë³€ê²½ì‚¬í•­ PostgreSQL ì˜êµ¬ ì €ì¥
- âœ… **F5 ìƒˆë¡œê³ ì¹¨**: ë³€ê²½ì‚¬í•­ ì™„ì „ ìœ ì§€

### ë‹¤ìŒ ë°°í¬ í›„ í™•ì¸ ì‚¬í•­
1. **GitHub Pages ìë™ ë°°í¬**: 081c51c ì»¤ë°‹ ê¸°ì¤€
2. **Render.com ë°±ì—”ë“œ**: API ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ì‘ë™
3. **ì‹¤ì œ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸**: test@ahp.com ê³„ì •ìœ¼ë¡œ ì´ë¦„ ë³€ê²½ í…ŒìŠ¤íŠ¸

## ğŸ“‹ ë°°í¬ í™˜ê²½ ìµœì¢… ì ê²€

### GitHub Pages ì„¤ì •
```json
{
  "homepage": "https://aebonlee.github.io/ahp-research-platform/",
  "scripts": {
    "predeploy": "npm run build:frontend",
    "deploy": "gh-pages -d build"
  }
}
```

### Render.com ë°±ì—”ë“œ ì„¤ì •
```yaml
# render.yaml
services:
  - type: web
    name: ahp-backend
    env: node
    buildCommand: cd backend && npm install && npm run build
    startCommand: cd backend && npm start
```

## ğŸ‰ ê²°ë¡ 

ë¡œì»¬ ê°œë°œ í™˜ê²½ìš© ì„ì‹œ ì½”ë“œë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³ , ì‹¤ì œ GitHub Pagesì™€ Render.com ë°°í¬ í™˜ê²½ì—ì„œ ì •ìƒ ì‘ë™í•˜ëŠ” ê°œì¸ì„¤ì • DB ì €ì¥ ì‹œìŠ¤í…œì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤. ì´ì œ ì‚¬ìš©ìê°€ ê°œì¸ì„¤ì •ì—ì„œ ë³€ê²½í•œ ì •ë³´ê°€ render.comì˜ PostgreSQLì— ì˜êµ¬ ì €ì¥ë˜ì–´ F5 ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ì™„ì „íˆ ìœ ì§€ë©ë‹ˆë‹¤.