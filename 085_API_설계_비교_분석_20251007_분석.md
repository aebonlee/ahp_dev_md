# API ì„¤ê³„ ë¹„êµ ë¶„ì„ (ìš”êµ¬ì‚¬í•­ vs í˜„ì¬ êµ¬í˜„)

## ì¼ì‹œ
- **ì¼ì‹œ**: 2025ë…„ 8ì›” 17ì¼ 10:00:00

## ğŸ“Š ì „ì²´ API êµ¬í˜„ í˜„í™©

### í˜„ì¬ ë°±ì—”ë“œ: **Node.js + Express + TypeScript**
**ìš”êµ¬ì‚¬í•­**: FastAPI (Python) ê¸°ë°˜ ì„¤ê³„  
**í˜„ì¬ êµ¬í˜„**: Express.js (Node.js) ê¸°ë°˜

## ğŸ” API ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ë¹„êµ

### âœ… ì˜ êµ¬í˜„ëœ API (85% ì¼ì¹˜)

#### 1. **í”„ë¡œì íŠ¸ ê´€ë¦¬**
| ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ | ë¹„ê³  |
|----------|-----------|------|------|
| `POST /projects` | âœ… `POST /api/projects` | ì™„ë£Œ | ìƒì„±/ìˆ˜ì • ê°€ëŠ¥ |
| `PUT /projects/:id` | âœ… `PUT /api/projects/:id` | ì™„ë£Œ | - |
| `DELETE /projects/:id` | âœ… `DELETE /api/projects/:id` | ì™„ë£Œ | - |
| `GET /projects` | âœ… `GET /api/projects` | ì™„ë£Œ | ê¶Œí•œë³„ í•„í„°ë§ |

**í˜„ì¬ êµ¬í˜„ ì½”ë“œ:**
```typescript
// âœ… ì™„ì „ êµ¬í˜„ë¨
router.post('/', authenticateToken, [...validation], async (req, res) => {
  const { title, description, objective } = req.body;
  // í”„ë¡œì íŠ¸ ìƒì„± ë¡œì§
});
```

#### 2. **ê¸°ì¤€(Criteria) ê´€ë¦¬**
| ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ | ë¹„ê³  |
|----------|-----------|------|------|
| `POST /criteria` | âœ… `POST /api/criteria` | ì™„ë£Œ | íŠ¸ë¦¬ êµ¬ì¡° ì§€ì› |
| `GET /criteria/:projectId` | âœ… `GET /api/criteria/:projectId` | ì™„ë£Œ | ê³„ì¸µ ì¡°íšŒ |
| `PUT /criteria/:id` | âœ… `PUT /api/criteria/:id` | ì™„ë£Œ | - |
| `DELETE /criteria/:id` | âœ… `DELETE /api/criteria/:id` | ì™„ë£Œ | ìì‹ ê²€ì¦ |

**í˜„ì¬ êµ¬í˜„ íŠ¹ì§•:**
```typescript
// âœ… ê³„ì¸µêµ¬ì¡° ì¿¼ë¦¬ ì™„ë²½ êµ¬í˜„
const criteriaResult = await query(`
  WITH RECURSIVE criteria_hierarchy AS (
    SELECT c.*, 0 as depth, ARRAY[c.id] as path
    FROM criteria c
    WHERE c.project_id = $1 AND c.parent_id IS NULL
    UNION ALL
    SELECT c.*, ch.depth + 1, ch.path || c.id
    FROM criteria c
    JOIN criteria_hierarchy ch ON c.parent_id = ch.id
    WHERE NOT c.id = ANY(ch.path)
  )
  SELECT * FROM criteria_hierarchy ORDER BY path, name
`);
```

#### 3. **ëŒ€ì•ˆ(Alternatives) ê´€ë¦¬**
| ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ | ë¹„ê³  |
|----------|-----------|------|------|
| `POST /alternatives` | âœ… `POST /api/alternatives` | ì™„ë£Œ | - |
| `GET /alternatives/:projectId` | âœ… `GET /api/alternatives/:projectId` | ì™„ë£Œ | - |
| `PUT /alternatives/:id` | âœ… `PUT /api/alternatives/:id` | ì™„ë£Œ | - |
| `DELETE /alternatives/:id` | âœ… `DELETE /api/alternatives/:id` | ì™„ë£Œ | - |

### ğŸ”„ ë¶€ë¶„ êµ¬í˜„ëœ API (60%)

#### 4. **í‰ê°€ì í• ë‹¹**
| ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ | ë¹„ê³  |
|----------|-----------|------|------|
| `POST /raters/assign` | âš ï¸ ë¶€ë¶„ êµ¬í˜„ | ë¯¸ì™„ì„± | project_evaluators í…Œì´ë¸”ë§Œ |

**í˜„ì¬ ìƒí™©:**
- ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆëŠ” ì¡´ì¬ (project_evaluators)
- API ì—”ë“œí¬ì¸íŠ¸ ë¯¸êµ¬í˜„
- í‰ê°€ì ì½”ë“œ(p001) ê¸°ëŠ¥ ì—†ìŒ

#### 5. **ìŒëŒ€ë¹„êµ í‰ê°€**
| ìš”êµ¬ì‚¬í•­ | í˜„ì¬ êµ¬í˜„ | ìƒíƒœ | ë¹„ê³  |
|----------|-----------|------|------|
| `POST /evaluate/pairwise` | ğŸ”„ `POST /api/comparisons` | ë¶€ë¶„ êµ¬í˜„ | matrix_key ì—†ìŒ |

**í˜„ì¬ êµ¬í˜„ vs ìš”êµ¬ì‚¬í•­:**
```typescript
// ìš”êµ¬ì‚¬í•­: matrix_key, i, j, value
POST /evaluate/pairwise {
  matrix_key: "C:criterionId" | "A:criterionId",
  i: number,
  j: number, 
  value: number
}

// í˜„ì¬ êµ¬í˜„: element1_id, element2_id ë°©ì‹
POST /api/comparisons {
  criterion1_id?: string,
  criterion2_id?: string,
  alternative1_id?: string,
  alternative2_id?: string,
  value: number
}
```

**ì°¨ì´ì :**
- âŒ **matrix_key ê°œë… ì—†ìŒ** - ë§¤íŠ¸ë¦­ìŠ¤ ì‹ë³„ ë¶ˆê°€
- âŒ **i, j ì¸ë±ìŠ¤ ì—†ìŒ** - ë§¤íŠ¸ë¦­ìŠ¤ ìœ„ì¹˜ ë¶ˆëª…í™•
- âœ… **ì—­ìˆ˜ ì²˜ë¦¬ ë¡œì§** - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬

### âŒ ì™„ì „ ë¯¸êµ¬í˜„ API (0%)

#### 6. **ì§ì ‘ì…ë ¥ í‰ê°€**
```typescript
// ìš”êµ¬ì‚¬í•­ - ì™„ì „ ë¯¸êµ¬í˜„
POST /evaluate/direct {
  target_key: string,  // "criterion:ID" or "alternative:ID@criterion:ID"
  value: number,
  is_benefit: boolean
}
```

#### 7. **ê²°ê³¼ ì¡°íšŒ ë° ë¶„ì„**
```typescript
// ìš”êµ¬ì‚¬í•­ - ì™„ì „ ë¯¸êµ¬í˜„
GET /results/:projectId     // ê°œì¸/í†µí•© ê²°ê³¼
POST /results/group         // í‰ê°€ì ê°€ì¤‘ í†µí•©
POST /analysis/sensitivity  // ë¯¼ê°ë„ ë¶„ì„
POST /analysis/budgeting    // ìì›ë°°ë¶„ ì‹œë®¬ë ˆì´ì…˜
```

#### 8. **ì‹¤ì‹œê°„ ì›Œí¬ìˆ**
```typescript
// ìš”êµ¬ì‚¬í•­ - ì™„ì „ ë¯¸êµ¬í˜„
WS /workshop  // WebSocket ì‹¤ì‹œê°„ ë™ê¸°í™”
```

## ğŸ”§ í•µì‹¬ AHP ì•Œê³ ë¦¬ì¦˜ API ëˆ„ë½

### í˜„ì¬ êµ¬í˜„ì— ì—†ëŠ” í•µì‹¬ ê¸°ëŠ¥:

#### 1. **AHP ê³„ì‚° ì„œë¹„ìŠ¤**
```typescript
// ë¯¸êµ¬í˜„ - ì¦‰ì‹œ í•„ìš”
class AHPService {
  // ê¸°í•˜í‰ê· ë²• ê°€ì¤‘ì¹˜ ê³„ì‚°
  static weightsGeomean(matrix: number[][]): number[];
  
  // ì¼ê´€ì„± ë¹„ìœ¨ ê³„ì‚°  
  static consistencyRatio(matrix: number[][], weights: number[]): {
    CR: number, CI: number, lambdaMax: number
  };
  
  // ë¹„ì¼ê´€ì„± ê°œì„  ì œì•ˆ
  static suggestFixes(matrix: number[][], weights: number[], topk: number): Array<{
    i: number, j: number, recommended: number
  }>;
}
```

#### 2. **ê²°ê³¼ ê³„ì‚° API**
```typescript
// ë¯¸êµ¬í˜„ - í•„ìˆ˜ API
POST /api/calculate/weights    // ê°€ì¤‘ì¹˜ ê³„ì‚°
POST /api/calculate/ranking    // ìµœì¢… ë­í‚¹
GET /api/results/:projectId    // ê²°ê³¼ ì¡°íšŒ
POST /api/results/export       // Excel/CSV ë‚´ë³´ë‚´ê¸°
```

#### 3. **ê·¸ë£¹ ì˜ì‚¬ê²°ì • API**
```typescript
// ë¯¸êµ¬í˜„ - ê·¸ë£¹ ê¸°ëŠ¥
POST /api/group/aggregate      // í‰ê°€ì ê²°ê³¼ í†µí•©
PUT /api/evaluators/:id/weight // í‰ê°€ì ê°€ì¤‘ì¹˜ ì„¤ì •
GET /api/progress/:projectId   // ì§„í–‰ ìƒí™© ì¡°íšŒ
```

## ğŸ“Š API ì•„í‚¤í…ì²˜ ë¹„êµ

### ìš”êµ¬ì‚¬í•­ ì•„í‚¤í…ì²˜ (Python/FastAPI)
```python
# core/ahp.py - ìˆ˜í•™ì  ê³„ì‚°
import numpy as np

def weights_geomean(A: np.ndarray):
    geo = np.prod(A, axis=1)**(1.0/A.shape[0])
    w = geo / np.sum(geo)
    return w

def consistency_ratio(A: np.ndarray, w: np.ndarray):
    lam_max = np.sum(np.dot(A, w)/w) / A.shape[0]
    CI = (lam_max - A.shape[0])/(A.shape[0]-1) if A.shape[0] > 2 else 0.0
    return CR, CI, lam_max
```

### í˜„ì¬ êµ¬í˜„ (Node.js/TypeScript)
```typescript
// utils/ahpCalculator.ts - í”„ë¡ íŠ¸ì—”ë“œì— êµ¬í˜„
export function calculateEigenVector(matrix: number[][]): number[] {
  // ê¸°í•˜í‰ê· ë²• êµ¬í˜„
}

export function calculateConsistencyRatio(lambdaMax: number, n: number): number {
  // CR ê³„ì‚° êµ¬í˜„
}
```

**ë¬¸ì œì :**
- ğŸš¨ **ë°±ì—”ë“œì— AHP ê³„ì‚° ë¡œì§ ì—†ìŒ**
- ğŸš¨ **ëª¨ë“  ê³„ì‚°ì´ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬**
- ğŸš¨ **ì„œë²„ì‚¬ì´ë“œ ê²°ê³¼ ì €ì¥/ìºì‹± ë¶ˆê°€**

## ğŸš€ ì¦‰ì‹œ êµ¬í˜„ í•„ìš”í•œ API

### Phase 1: í•µì‹¬ ê³„ì‚° API (1ì£¼)
```typescript
// 1. AHP ê³„ì‚° ì„œë¹„ìŠ¤ êµ¬í˜„
POST /api/calculate/matrix     // ë§¤íŠ¸ë¦­ìŠ¤ â†’ ê°€ì¤‘ì¹˜
POST /api/calculate/hierarchy  // ê³„ì¸µ í†µí•© ê³„ì‚°
POST /api/calculate/consistency // ì¼ê´€ì„± ê²€ì¦

// 2. ê²°ê³¼ ì €ì¥/ì¡°íšŒ
POST /api/results/save         // ê²°ê³¼ ì €ì¥
GET /api/results/:projectId    // ê²°ê³¼ ì¡°íšŒ
```

### Phase 2: ì§ì ‘ì…ë ¥ ë° ê·¸ë£¹ ê¸°ëŠ¥ (1ì£¼)
```typescript
// 3. ì§ì ‘ì…ë ¥ API
POST /api/evaluate/direct      // ì •ëŸ‰ ë°ì´í„° ì…ë ¥
POST /api/normalize/values     // Benefit/Cost ì •ê·œí™”

// 4. í‰ê°€ì ê´€ë¦¬
POST /api/evaluators/assign    // í‰ê°€ì í• ë‹¹
PUT /api/evaluators/:id/weight // ê°€ì¤‘ì¹˜ ì„¤ì •
GET /api/progress/:projectId   // ì§„í–‰ ìƒí™©
```

### Phase 3: ê³ ê¸‰ ë¶„ì„ API (2ì£¼)
```typescript
// 5. ë¶„ì„ ë„êµ¬
POST /api/analysis/sensitivity    // ë¯¼ê°ë„ ë¶„ì„
POST /api/analysis/improvements   // ê°œì„  ì œì•ˆ
POST /api/analysis/budgeting      // ìì›ë°°ë¶„

// 6. ë‚´ë³´ë‚´ê¸°
POST /api/export/excel        // Excel ë‚´ë³´ë‚´ê¸°
POST /api/export/pdf          // PDF ë¦¬í¬íŠ¸
```

## ğŸ”„ ê¸°ì¡´ API ê°œì„  í•„ìš”ì‚¬í•­

### 1. **ìŒëŒ€ë¹„êµ API ê°œì„ **
```typescript
// í˜„ì¬ ë°©ì‹ ê°œì„  í•„ìš”
interface ComparisonRequest {
  matrix_key: string;    // "C:criterionId" or "A:criterionId"  
  i: number;             // í–‰ ì¸ë±ìŠ¤
  j: number;             // ì—´ ì¸ë±ìŠ¤
  value: number;         // ì‚¬í‹° ì²™ë„ê°’
}
```

### 2. **ê¶Œí•œ ì²´ê³„ ê°•í™”**
```typescript
// ì—­í• ë³„ ì„¸ë¶„í™” í•„ìš”
enum Permission {
  PROJECT_CREATE = 'project:create',
  PROJECT_EDIT = 'project:edit',
  EVALUATE = 'evaluate',
  VIEW_RESULTS = 'results:view',
  EXPORT_DATA = 'export:data'
}
```

### 3. **ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”**
```typescript
// í‘œì¤€ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
interface APIError {
  code: string;
  message: string;
  details?: any;
  timestamp: string;
}
```

## ğŸ“ˆ API êµ¬í˜„ ì™„ì„±ë„ í‰ê°€

### ì „ì²´ API ì™„ì„±ë„: **40%**

| API ì¹´í…Œê³ ë¦¬ | ì™„ì„±ë„ | ìƒíƒœ | ìš°ì„ ìˆœìœ„ |
|-------------|--------|------|----------|
| **í”„ë¡œì íŠ¸ ê´€ë¦¬** | 95% | âœ… ì™„ë£Œ | - |
| **ê¸°ì¤€/ëŒ€ì•ˆ ê´€ë¦¬** | 90% | âœ… ì™„ë£Œ | - |
| **ì‚¬ìš©ì/ì¸ì¦** | 85% | âœ… ì™„ë£Œ | - |
| **ìŒëŒ€ë¹„êµ** | 60% | ğŸ”„ ê°œì„  í•„ìš” | ğŸ”¥ ë†’ìŒ |
| **ì§ì ‘ì…ë ¥** | 0% | âŒ ë¯¸êµ¬í˜„ | ğŸ”¥ ë†’ìŒ |
| **AHP ê³„ì‚°** | 0% | âŒ ë¯¸êµ¬í˜„ | ğŸ”¥ ìµœìš°ì„  |
| **ê²°ê³¼ ë¶„ì„** | 0% | âŒ ë¯¸êµ¬í˜„ | ğŸ”¥ ë†’ìŒ |
| **ê·¸ë£¹ ì˜ì‚¬ê²°ì •** | 10% | âŒ ë¯¸êµ¬í˜„ | ğŸ”¶ ì¤‘ê°„ |
| **ì‹¤ì‹œê°„ í˜‘ì—…** | 0% | âŒ ë¯¸êµ¬í˜„ | ğŸ”¹ ë‚®ìŒ |

## ğŸ¯ ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### âœ… í˜„ì¬ ê°•ì 
1. **íƒ„íƒ„í•œ ê¸°ì´ˆ API**: í”„ë¡œì íŠ¸, ê¸°ì¤€, ëŒ€ì•ˆ ê´€ë¦¬ ì™„ë²½
2. **ë³´ì•ˆ êµ¬í˜„**: JWT ì¸ì¦, ê¶Œí•œ ì²´ê³„ ìš°ìˆ˜
3. **ë°ì´í„° ê²€ì¦**: express-validator í™œìš©
4. **íŠ¸ëœì­ì…˜ ì²˜ë¦¬**: ë°ì´í„°ë² ì´ìŠ¤ ì¼ê´€ì„± ìœ ì§€

### ğŸš¨ ê¸´ê¸‰ ê°œì„  í•„ìš”
1. **AHP ê³„ì‚° API ë°±ì—”ë“œ êµ¬í˜„** - ìµœìš°ì„ 
2. **ì§ì ‘ì…ë ¥ í‰ê°€ API** - ì •ëŸ‰ ë°ì´í„° ì²˜ë¦¬
3. **ê²°ê³¼ ì €ì¥/ì¡°íšŒ ì‹œìŠ¤í…œ** - ìºì‹± ë° ì„±ëŠ¥
4. **ë§¤íŠ¸ë¦­ìŠ¤ í‚¤ ì‹œìŠ¤í…œ** - ìŒëŒ€ë¹„êµ ê°œì„ 

í˜„ì¬ APIëŠ” **ê¸°ì´ˆ CRUDëŠ” ìš°ìˆ˜**í•˜ë‚˜, **í•µì‹¬ AHP ê³„ì‚° ë¡œì§ì´ ë°±ì—”ë“œì— ì—†ì–´** ì™„ì „í•œ ì‹œìŠ¤í…œì´ ë˜ë ¤ë©´ **ìˆ˜í•™ì  ê³„ì‚° APIì˜ ì¦‰ì‹œ êµ¬í˜„**ì´ í•„ìš”í•©ë‹ˆë‹¤.