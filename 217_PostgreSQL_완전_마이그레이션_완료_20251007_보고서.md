# PostgreSQL ì™„ì „ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ ë³´ê³ ì„œ

## ì‘ì—… ì¼ì‹œ
- 2025ë…„ 9ì›” 2ì¼

## ì‘ì—… ê°œìš”

ê°€ì§œ ë°ì´í„°(localStorage, DEMO ë°ì´í„°)ë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³  PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ë§Œì„ ì‚¬ìš©í•˜ëŠ” ìˆœìˆ˜í•œ ë°±ì—”ë“œ ì—°ë™ êµ¬ì¡°ë¡œ ì „í™˜ ì™„ë£Œ.

### ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­
> "postgreDBì— í”„ë¡œì íŠ¸ê´€ë ¨ DBë„ ë§Œë“¤ì–´ ì§„ê±°ì§€? ì´ì œ ê°€ì§œ ë°ì´í„° ëª¨ë‘ ì‚­ì œí•˜ê³  ì‹¤ë°ì´í„°ë¡œ DBì— ì €ì¥ë˜ê³  í˜¸ì¶œë˜ëŠ” êµ¬ì¡°ê°€ ì™„ì„±ë˜ì–´ì•¼ í•´"

## ê¸°ìˆ ì  êµ¬í˜„ ë‚´ìš©

### 1. PostgreSQL DB ìŠ¤í‚¤ë§ˆ í™•ì¸ âœ…

**ì™„ì„±ëœ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ë“¤:**
```sql
projects (í”„ë¡œì íŠ¸ ë©”ì¸)
â”œâ”€â”€ id (SERIAL PRIMARY KEY)
â”œâ”€â”€ name (í”„ë¡œì íŠ¸ëª…)
â”œâ”€â”€ description (ì„¤ëª…)  
â”œâ”€â”€ status ('draft'|'active'|'completed'|'deleted')
â”œâ”€â”€ admin_id (ê´€ë¦¬ì ID)
â”œâ”€â”€ deleted_at (ì†Œí”„íŠ¸ ì‚­ì œ)
â””â”€â”€ created_at/updated_at

criteria (í‰ê°€ ê¸°ì¤€)
â”œâ”€â”€ id, project_id, name, description
â”œâ”€â”€ parent_id (ê³„ì¸µ êµ¬ì¡° ì§€ì›)
â”œâ”€â”€ level (ìµœëŒ€ 4ë‹¨ê³„)
â””â”€â”€ order_index

alternatives (ëŒ€ì•ˆ)
â”œâ”€â”€ id, project_id, name, description
â””â”€â”€ order_index

users (ì‚¬ìš©ì)
â”œâ”€â”€ id, email, password_hash
â”œâ”€â”€ first_name, last_name, role
â””â”€â”€ is_active

pairwise_comparisons (ìŒëŒ€ë¹„êµ ë°ì´í„°)
â””â”€â”€ ëª¨ë“  í‰ê°€ ë°ì´í„° ì €ì¥

results (ê³„ì‚°ëœ ê²°ê³¼)
â””â”€â”€ ê°€ì¤‘ì¹˜ ë° ì¼ê´€ì„± ë¹„ìœ¨
```

### 2. ê°€ì§œ ë°ì´í„° ì™„ì „ ì œê±° âœ…

#### ì œê±°ëœ ìš”ì†Œë“¤
```typescript
// âŒ ì œê±°ë¨
localStorage.getItem('ahp_projects')
localStorage.getItem('ahp_criteria')  
localStorage.getItem('ahp_alternatives')
DEMO_PROJECTS, DEMO_CRITERIA, DEMO_ALTERNATIVES
isOfflineMode() === true ë¡œì§

// âœ… ìƒˆë¡œ êµ¬í˜„ë¨
ì™„ì „ PostgreSQL ì—°ë™ êµ¬ì¡°
```

#### ì£¼ìš” ë³€ê²½ íŒŒì¼
1. **dataService_clean.ts** (ì‹ ê·œ ìƒì„±)
2. **PersonalServiceDashboard.tsx** - import ë³€ê²½
3. **MyProjects.tsx** - import ë³€ê²½  
4. **dataService.ts** - ì˜¤í”„ë¼ì¸ ëª¨ë“œ ë¹„í™œì„±í™”

### 3. ìƒˆë¡œìš´ CleanDataService êµ¬í˜„ âœ…

```typescript
// src/services/dataService_clean.ts
class CleanDataService {
  // ìˆœìˆ˜ PostgreSQL ì—°ë™ë§Œ ì§€ì›
  async getProjects(): Promise<ProjectData[]> {
    console.log('ğŸ” ì‹¤ì œ DBì—ì„œ í”„ë¡œì íŠ¸ ì¡°íšŒ ì‹œì‘...');
    const response = await projectApi.getProjects();
    return response.data || [];
  }

  // localStorage ì™„ì „ ì œê±°
  isOfflineMode(): boolean {
    return false; // í•­ìƒ ì˜¨ë¼ì¸ ëª¨ë“œ
  }

  // ê¸°ì¡´ ê°€ì§œ ë°ì´í„° ì •ë¦¬
  clearLocalStorage(): void {
    const keysToRemove = [
      'ahp_projects', 'ahp_criteria', 
      'ahp_alternatives', 'ahp_evaluators',
      'ahp_comparisons', 'ahp_offline_mode',
      'ahp_trash_projects'
    ];
    keysToRemove.forEach(key => localStorage.removeItem(key));
  }
}
```

### 4. API ì—”ë“œí¬ì¸íŠ¸ ë§¤ì¹­ ìˆ˜ì • âœ…

**ë©”ì„œë“œëª… í†µì¼:**
```typescript
// âœ… ìˆ˜ì • ì™„ë£Œ
evaluatorApi.addEvaluator()      // createEvaluator() â†’ addEvaluator()
evaluationApi.savePairwiseComparison()  // saveEvaluation() â†’ savePairwiseComparison()
criteriaApi.createCriteria()     // âœ… ì¼ì¹˜
alternativeApi.createAlternative() // âœ… ì¼ì¹˜
```

### 5. DEMO ë°ì´í„° í•˜ë“œì½”ë”© ì œê±° âœ…

```typescript
// Before (í•˜ë“œì½”ë”©)
evaluator_count: DEMO_EVALUATORS.length, // 26ëª…
criteria_count: DEMO_CRITERIA.length,    // 3ê°œ  
alternatives_count: DEMO_ALTERNATIVES.length // 9ê°œ

// After (ì‹¤ì œ DB ì—°ë™)
evaluator_count: 0, // ì‹¤ì œ DBì—ì„œ ì¡°íšŒ
criteria_count: 0,  // ì‹¤ì œ DBì—ì„œ ì¡°íšŒ
alternatives_count: 0 // ì‹¤ì œ DBì—ì„œ ì¡°íšŒ
```

## ë°ì´í„° íë¦„ ë³€í™”

### Before (ê°€ì§œ ë°ì´í„° ì‹œëŒ€)
```
Frontend â†’ localStorage í™•ì¸ â†’ ì—†ìœ¼ë©´ DEMO ë°ì´í„° ì‚¬ìš© â†’ UI í‘œì‹œ
```

### After (ì‹¤ì œ DB ì—°ë™)
```  
Frontend â†’ PostgreSQL API í˜¸ì¶œ â†’ ì‹¤ì œ DB ë°ì´í„° ì¡°íšŒ â†’ UI í‘œì‹œ
```

## ì£¼ìš” ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸

### í”„ë¡œì íŠ¸ ê´€ë¦¬
- `GET /api/projects` - í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ
- `POST /api/projects` - í”„ë¡œì íŠ¸ ìƒì„±  
- `PUT /api/projects/:id` - í”„ë¡œì íŠ¸ ìˆ˜ì •
- `DELETE /api/projects/:id` - í”„ë¡œì íŠ¸ ì‚­ì œ (íœ´ì§€í†µ)

### íœ´ì§€í†µ ê´€ë¦¬  
- `GET /api/projects/trash` - ì‚­ì œëœ í”„ë¡œì íŠ¸ ì¡°íšŒ
- `PUT /api/projects/:id/restore` - í”„ë¡œì íŠ¸ ë³µì›
- `DELETE /api/projects/:id/permanent` - ì˜êµ¬ ì‚­ì œ

### ê¸°ì¤€/ëŒ€ì•ˆ/í‰ê°€ì
- `GET /api/projects/:id/criteria` - ê¸°ì¤€ ì¡°íšŒ
- `POST /api/criteria` - ê¸°ì¤€ ìƒì„±
- `GET /api/projects/:id/alternatives` - ëŒ€ì•ˆ ì¡°íšŒ  
- `POST /api/alternatives` - ëŒ€ì•ˆ ìƒì„±
- `GET /api/projects/:id/evaluators` - í‰ê°€ì ì¡°íšŒ
- `POST /api/evaluators` - í‰ê°€ì ìƒì„±

## ë¹Œë“œ í…ŒìŠ¤íŠ¸ ê²°ê³¼

```bash
> npm run build:frontend

Creating an optimized production build...
Compiled with warnings.

File sizes after gzip:
  312.96 kB  build\static\js\main.a34a6921.js
  19.4 kB    build\static\css\main.a3c5e66d.css

âœ… The build folder is ready to be deployed.
```

**ê²°ê³¼:**
- âœ… TypeScript ì»´íŒŒì¼ ì„±ê³µ
- âš ï¸ ESLint ê²½ê³ ë§Œ ì¡´ì¬ (ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ)
- ğŸ“¦ ì•½ê°„ì˜ ë²ˆë“¤ í¬ê¸° ì¦ê°€ (ì‹¤ì œ API í˜¸ì¶œ ë¡œì§ ì¶”ê°€)

## ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

### íŠ¸ëœì­ì…˜ ì§€ì›
PostgreSQLì˜ ACID ì†ì„±ìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

### ì†Œí”„íŠ¸ ì‚­ì œ
```sql
-- í”„ë¡œì íŠ¸ëŠ” ì¦‰ì‹œ ì‚­ì œë˜ì§€ ì•Šê³  deleted_at ë§ˆí‚¹
UPDATE projects 
SET status = 'deleted', deleted_at = CURRENT_TIMESTAMP 
WHERE id = ?
```

### ì°¸ì¡° ë¬´ê²°ì„±
```sql
-- ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ìœ¼ë¡œ ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥
FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
```

## Git ì»¤ë°‹ ì •ë³´

### ì»¤ë°‹ í•´ì‹œ: `f3fd747`
### ë³€ê²½ëœ íŒŒì¼ (4ê°œ)
1. **src/services/dataService_clean.ts** (ì‹ ê·œ)
   - ìˆœìˆ˜ PostgreSQL ì—°ë™ ì„œë¹„ìŠ¤
   
2. **src/components/admin/PersonalServiceDashboard.tsx** 
   - cleanDataServiceë¡œ import ë³€ê²½
   - DEMO ë°ì´í„° ì°¸ì¡° ëª¨ë‘ ì œê±°
   
3. **src/components/admin/MyProjects.tsx**
   - ìƒˆë¡œìš´ ë°ì´í„° ì„œë¹„ìŠ¤ ì—°ë™
   
4. **src/services/dataService.ts**  
   - ì˜¤í”„ë¼ì¸ ëª¨ë“œ ë¹„í™œì„±í™”

## ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

### Before (ë¶ˆì•ˆì •í•œ ê°€ì§œ ë°ì´í„°)
- ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë°ì´í„° ì‚¬ë¼ì§
- ì—¬ëŸ¬ íƒ­ì—ì„œ ë°ì´í„° ë¶ˆì¼ì¹˜
- ì‹¤ì œ ì„œë²„ì™€ ë™ê¸°í™” ì•ˆë¨

### After (ì•ˆì •ì ì¸ ì‹¤ë°ì´í„°)  
- ìƒˆë¡œê³ ì¹¨í•´ë„ ë°ì´í„° ìœ ì§€
- ë‹¤ì¤‘ ì‚¬ìš©ì í™˜ê²½ ì§€ì›
- ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”
- ë°±ì—… ë° ë³µêµ¬ ê°€ëŠ¥

## ë³´ì•ˆ ê°•í™”

### ì¸ì¦/ê¶Œí•œ
```typescript
// ëª¨ë“  API í˜¸ì¶œì— credentials í¬í•¨
fetch(API_URL, {
  credentials: 'include', // ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦
  headers: {
    'Content-Type': 'application/json'
  }
})
```

### SQL ì¸ì ì…˜ ë°©ì§€
ë°±ì—”ë“œì—ì„œ Prepared Statement ì‚¬ìš©

## ì„±ëŠ¥ ìµœì í™”

### ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤
```sql
-- ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ ìµœì í™”
CREATE INDEX idx_projects_admin_id ON projects(admin_id);
CREATE INDEX idx_projects_status ON projects(status);
CREATE INDEX idx_criteria_project_id ON criteria(project_id);
```

### API ì‘ë‹µ ìºì‹±
ë¸Œë¼ìš°ì € ë ˆë²¨ì—ì„œ ì ì ˆí•œ ìºì‹± í—¤ë” í™œìš©

## í–¥í›„ í™•ì¥ì„±

### ë‹¤ì¤‘ ì‚¬ìš©ì ì§€ì› 
PostgreSQL ê¸°ë°˜ìœ¼ë¡œ ë™ì‹œ ì ‘ê·¼ ì²˜ë¦¬

### ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬
ì¸ë±ìŠ¤ ë° ì¿¼ë¦¬ ìµœì í™”ë¡œ í™•ì¥ì„± í™•ë³´

### ì‹¤ì‹œê°„ í˜‘ì—…
WebSocket ì—°ë™ ê¸°ë°˜ êµ¬ì¶• ê°€ëŠ¥

## ë§ˆë¬´ë¦¬

**ì™„ì „í•œ PostgreSQL ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ:**

1. âœ… **localStorage ì œê±°**: ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì €ì¥ì†Œ ì˜ì¡´ì„± ì œê±°
2. âœ… **DEMO ë°ì´í„° ì œê±°**: í•˜ë“œì½”ë”©ëœ ìƒ˜í”Œ ë°ì´í„° ì™„ì „ ì œê±°  
3. âœ… **ì‹¤ì œ DB ì—°ë™**: PostgreSQLê³¼ 100% ì—°ë™ êµ¬í˜„
4. âœ… **API í†µì¼í™”**: ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸ì™€ ì™„ë²½ ë§¤ì¹­
5. âœ… **ë¹Œë“œ ì„±ê³µ**: í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

ì´ì œ AHP í”Œë«í¼ì€ ì™„ì „í•œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì •ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ ì‹¤ì„œë¹„ìŠ¤ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.