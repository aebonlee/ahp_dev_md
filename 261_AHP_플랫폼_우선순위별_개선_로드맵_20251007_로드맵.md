# AHP 플랫폼 우선순위별 개선 로드맵

**작성일**: 2025-09-02  
**작성자**: Claude Code  
**기준 버전**: v2.3.2

---

## 🎯 우선순위 매트릭스

| 우선순위 | 영향도 | 긴급도 | 구현 난이도 | 예상 기간 | 담당자 |
|----------|--------|--------|-------------|-----------|---------|
| **🔴 P0** | 매우 높음 | 즉시 | 낮음 | 1-7일 | Backend Dev |
| **🟠 P1** | 높음 | 높음 | 중간 | 1-4주 | Full-Stack |
| **🟡 P2** | 중간 | 중간 | 중간 | 1-3개월 | Team |
| **🟢 P3** | 낮음 | 낮음 | 높음 | 3-6개월 | Team |

---

## 🔴 P0: 즉시 조치 (Critical) - 1주일 내

### 🚨 보안 취약점 (생산성 영향: 100%)

#### 1. JWT Secret 하드코딩 제거
**파일**: `backend/src/utils/auth.ts:11`  
**예상 시간**: 30분  
**위험도**: Critical  

```typescript
// 현재 (위험)
const JWT_SECRET = process.env.JWT_SECRET || 'fallback-secret-key';

// 수정안
const JWT_SECRET = process.env.JWT_SECRET;
if (!JWT_SECRET) {
  console.error('🚨 CRITICAL: JWT_SECRET environment variable is required');
  process.exit(1);
}
```

#### 2. 관리자 API 무인증 접근 차단
**파일**: `backend/src/index.ts:87-434`  
**예상 시간**: 2시간  
**위험도**: Critical  

```typescript
// 수정할 엔드포인트 (총 8개)
❌ app.post('/api/admin/migrate')                    // DB 마이그레이션
❌ app.get('/api/admin/users')                       // 전체 사용자 정보  
❌ app.post('/api/admin/create-test-user')           // 테스트 계정 생성
❌ app.post('/api/emergency/cleanup-phantom-projects') // 데이터 삭제
❌ app.get('/api/quick-cleanup-phantoms')            // 빠른 정리
❌ app.get('/api/debug/database-status')             // DB 상태 조회
❌ app.get('/api/debug/tables')                      // 테이블 정보
❌ app.get('/api/debug/recent-users')                // 최근 사용자

// 보안 강화 적용
✅ app.use('/api/admin/*', [authenticateToken, requireRole(['super_admin']), auditLogger]);
✅ app.use('/api/emergency/*', [authenticateToken, requireRole(['super_admin']), confirmationRequired]);
✅ app.use('/api/debug/*', [authenticateToken, requireRole(['super_admin']), ipWhitelist]);
```

#### 3. 약한 비밀번호 해싱 교체
**파일**: `backend/src/routes/evaluators.ts:836`  
**예상 시간**: 15분  
**위험도**: High  

```typescript
// 현재 (취약)
async function hashPassword(password: string): Promise<string> {
  return crypto.createHash('sha256').update(password).digest('hex');
}

// 수정안
import bcrypt from 'bcryptjs';
async function hashPassword(password: string): Promise<string> {
  const saltRounds = 12; // 높은 보안 수준
  return bcrypt.hash(password, saltRounds);
}
```

### 🛡️ 즉시 배포 스크립트

```bash
#!/bin/bash
# scripts/emergency-security-patch.sh

echo "🚨 Emergency Security Patch Deployment"

# 1. JWT Secret 환경변수 확인
if [ -z "$JWT_SECRET" ]; then
  echo "❌ JWT_SECRET not set. Please configure in Render dashboard."
  exit 1
fi

# 2. 백엔드 빌드 및 테스트
cd backend
npm run build
npm test

# 3. 보안 감사
npm audit --audit-level=high

# 4. 배포 (Render.com 자동 배포)
git add .
git commit -m "🔒 Security patch: Fix JWT and admin API vulnerabilities"
git push origin main

echo "✅ Security patch deployed. Monitor logs for 30 minutes."
```

---

## 🟠 P1: 높음 (High) - 1-4주 내

### 📊 영향도 vs 구현 난이도 매트릭스

| 작업 | 영향도 | 구현 난이도 | 예상 시간 | 우선순위 |
|------|--------|-------------|-----------|----------|
| App.tsx 리팩토링 | 매우 높음 | 중간 | 1주 | P1-1 |
| Rate Limiting | 높음 | 낮음 | 1일 | P1-2 |
| 번들 크기 최적화 | 높음 | 중간 | 3일 | P1-3 |
| DB 인덱스 최적화 | 중간 | 낮음 | 2일 | P1-4 |
| CORS 보안 강화 | 중간 | 낮음 | 1일 | P1-5 |

### P1-1: App.tsx 거대 컴포넌트 분할 (1주)
**현재 상태**: 1,774줄 (권장: 300줄 이하)  
**영향**: 개발 생산성 30% 향상, 버그 위험 50% 감소

**실행 계획**:
```
Day 1-2: 라우터 분리
├── src/router/AppRouter.tsx (100줄)
├── src/router/routes.ts (50줄)
└── src/router/ProtectedRoute.tsx (30줄)

Day 3-4: Context Provider 분리  
├── src/providers/UserProvider.tsx (80줄)
├── src/providers/ProjectProvider.tsx (120줄)
├── src/providers/ThemeProvider.tsx (60줄)
└── src/providers/AppProvider.tsx (40줄)

Day 5-7: 메인 App.tsx 단순화
├── hooks 분리: src/hooks/ (10개 파일)
├── utils 분리: src/utils/ (5개 파일)  
└── App.tsx 최종: 50줄 이하
```

### P1-2: Rate Limiting 구현 (1일)
```typescript
// src/middleware/rateLimiter.ts
import rateLimit from 'express-rate-limit';

export const createRateLimiter = (windowMs: number, max: number, message: string) => 
  rateLimit({
    windowMs,
    max,
    message: { error: message, code: 'RATE_LIMIT_EXCEEDED' },
    standardHeaders: true,
    legacyHeaders: false,
    handler: (req, res) => {
      console.warn(`Rate limit exceeded: ${req.ip} ${req.path}`);
      res.status(429).json({ 
        error: message, 
        retryAfter: Math.ceil(windowMs / 1000) 
      });
    }
  });

// 적용할 제한 정책
export const limiters = {
  auth: createRateLimiter(15 * 60 * 1000, 5, 'Too many authentication attempts'),
  api: createRateLimiter(1 * 60 * 1000, 100, 'Too many API requests'),
  admin: createRateLimiter(5 * 60 * 1000, 10, 'Admin API rate limit exceeded'),
  export: createRateLimiter(10 * 60 * 1000, 3, 'Export rate limit exceeded')
};
```

### P1-3: 번들 크기 최적화 (3일)
**현재**: 315.67 kB (gzipped)  
**목표**: 200 kB 이하  
**예상 개선**: 페이지 로딩 속도 40% 향상

```typescript
// Day 1: 코드 분할 적용
const AdminDashboard = lazy(() => import('./components/admin/PersonalServiceDashboard'));
const AnalysisDashboard = lazy(() => import('./components/analysis/ResultsAnalysis'));

// Day 2: Tree shaking 최적화
// webpack.config.js 수정 또는 package.json 최적화

// Day 3: 불필요한 의존성 제거
// - 사용하지 않는 라이브러리 식별 및 제거
// - lodash → 개별 함수 import
```

---

## 🟡 P2: 중간 (Medium) - 1-3개월 내

### 🎯 우선순위 점수 계산 방식
```
우선순위 점수 = (영향도 × 4) + (긴급도 × 3) + (구현용이성 × 2) + (ROI × 3)
```

| 작업명 | 영향도 | 긴급도 | 용이성 | ROI | 총점 | 순위 |
|--------|--------|--------|--------|-----|------|------|
| 테스트 자동화 | 8 | 6 | 7 | 9 | 78 | P2-1 |
| API 문서화 | 7 | 5 | 8 | 8 | 72 | P2-2 |
| 모니터링 시스템 | 8 | 7 | 6 | 7 | 74 | P2-3 |
| DB 스키마 정리 | 6 | 8 | 9 | 6 | 71 | P2-4 |
| 에러 추적 시스템 | 7 | 6 | 7 | 7 | 70 | P2-5 |

### P2-1: 테스트 자동화 확대 (4주)
**목표**: 테스트 커버리지 30% → 80%

```
주차 1: 프론트엔드 단위 테스트
├── 핵심 컴포넌트 테스트 (PersonalServiceDashboard 등)
├── Utility 함수 테스트 (AHP Calculator 등)
└── Hook 테스트 (useAuth, useTheme 등)

주차 2: 백엔드 단위 테스트  
├── API 라우터 테스트 (auth, projects, evaluators)
├── 서비스 레이어 테스트 (userService, ahpCalculator)
└── 미들웨어 테스트 (auth, validation)

주차 3: 통합 테스트
├── API 엔드포인트 통합 테스트
├── 데이터베이스 트랜잭션 테스트
└── 인증 플로우 테스트

주차 4: E2E 테스트
├── 사용자 시나리오 테스트 (로그인→프로젝트생성→분석)
├── 평가자 워크플로우 테스트
└── 관리자 기능 테스트
```

### P2-2: API 문서화 (OpenAPI/Swagger) (2주)
```yaml
# swagger.yaml
openapi: 3.0.0
info:
  title: AHP Platform API
  version: 2.3.2
  description: Analytic Hierarchy Process Decision Support System

paths:
  /api/auth/login:
    post:
      summary: User authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
      responses:
        200:
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        401:
          description: Invalid credentials
```

---

## 🟢 P3: 낮음 (Low) - 3-6개월 내

### 아키텍처 고도화 로드맵

#### Quarter 1 (3개월): 기반 강화
```
Month 1: 성능 최적화
├── 캐싱 시스템 도입 (Redis)
├── CDN 적용 (Cloudflare)
├── 이미지 최적화 (WebP, 지연 로딩)
└── 데이터베이스 튜닝

Month 2: 사용자 경험
├── PWA 변환 (오프라인 지원)
├── 접근성 완전 지원 (WCAG 2.1 AA)
├── 다국어 지원 (i18n)
└── 모바일 최적화

Month 3: 개발 프로세스
├── 코드 품질 자동화 (SonarQube)
├── 자동화된 릴리즈 노트
├── 성능 회귀 테스트
└── 보안 스캔 자동화
```

#### Quarter 2 (6개월): 확장성
```
Month 4-6: 마이크로서비스 전환
├── Auth Service 분리
├── Project Service 분리  
├── Analysis Service 분리
└── API Gateway 구축
```

---

## ⏰ 시간별 실행 계획

### 🚨 Week 1: Emergency Fixes
```
Monday:
├── 09:00-10:00 JWT Secret 환경변수 마이그레이션
├── 10:00-12:00 관리자 API 인증 추가
├── 14:00-15:00 약한 해싱 알고리즘 교체
└── 15:00-17:00 SQL Injection 방어 강화

Tuesday-Wednesday:
├── Rate Limiting 구현 및 테스트
├── CORS 보안 정책 강화
├── 전체 보안 테스트 수행
└── 긴급 배포 및 모니터링

Thursday-Friday:
├── 보안 패치 검증
├── 성능 영향 분석
├── 사용자 피드백 수집
└── 문서 업데이트
```

### 📈 Week 2-4: Performance & Quality
```
Week 2: Frontend 최적화
├── App.tsx 컴포넌트 분할 (Day 1-3)
├── 번들 크기 최적화 (Day 4-5)

Week 3: Backend 최적화  
├── DB 인덱스 추가 (Day 1)
├── API 응답 최적화 (Day 2-3)
├── 쿼리 성능 튜닝 (Day 4-5)

Week 4: 테스트 & 문서화
├── 핵심 기능 테스트 작성 (Day 1-3)
├── API 문서화 (Day 4-5)
```

---

## 📋 우선순위별 상세 체크리스트

### 🔴 P0 체크리스트 (이번 주 필수)

#### 보안 패치 (4시간)
- [ ] **JWT_SECRET 하드코딩 제거** (30분)
  - [ ] backend/src/utils/auth.ts 수정
  - [ ] Render.com 환경변수 설정 확인
  - [ ] 로컬 테스트 수행

- [ ] **관리자 API 인증 추가** (2시간)
  - [ ] /api/admin/* 라우트에 인증 미들웨어 적용
  - [ ] /api/emergency/* 라우트에 슈퍼관리자 권한 적용  
  - [ ] /api/debug/* 라우트 IP 화이트리스트 추가
  - [ ] 변경사항 테스트

- [ ] **약한 해싱 알고리즘 교체** (30분)
  - [ ] SHA-256 → bcrypt 변경
  - [ ] 기존 해시된 패스워드 마이그레이션 계획 수립

- [ ] **SQL Injection 방어 강화** (1시간)
  - [ ] 동적 쿼리에 화이트리스트 검증 추가
  - [ ] 매개변수화된 쿼리 패턴 통일
  - [ ] 보안 테스트 수행

#### 배포 및 검증 (2시간)
- [ ] **빌드 및 테스트**
  - [ ] 프론트엔드 빌드 성공 확인
  - [ ] 백엔드 빌드 성공 확인
  - [ ] 기본 기능 테스트

- [ ] **프로덕션 배포**  
  - [ ] GitHub 커밋 및 푸시
  - [ ] Render.com 자동 배포 확인
  - [ ] 배포 후 헬스체크

- [ ] **모니터링**
  - [ ] API 응답 시간 측정
  - [ ] 에러 로그 모니터링 (30분간)
  - [ ] 사용자 접근 테스트

### 🟠 P1 체크리스트 (다음 달 중요)

#### 성능 최적화 (2주)
- [ ] **App.tsx 리팩토링** (1주)
  - [ ] Day 1-2: Router 분리
  - [ ] Day 3-4: Context Provider 분리
  - [ ] Day 5-7: 메인 컴포넌트 최적화

- [ ] **번들 최적화** (3일)
  - [ ] 코드 분할 적용
  - [ ] Tree shaking 최적화
  - [ ] 번들 분석기로 검증

#### 보안 강화 (1주)
- [ ] **Rate Limiting** (1일)
  - [ ] express-rate-limit 설정
  - [ ] 엔드포인트별 제한 정책 적용
  - [ ] 제한 초과 시 로깅

- [ ] **CORS 강화** (1일)  
  - [ ] Origin 화이트리스트 관리
  - [ ] Preflight 요청 최적화
  - [ ] Credential 보안 강화

#### 데이터베이스 (1주)
- [ ] **인덱스 최적화** (2일)
  - [ ] 슬로우 쿼리 분석
  - [ ] 복합 인덱스 설계 및 적용
  - [ ] 성능 테스트

- [ ] **스키마 정리** (3일)
  - [ ] 중복 마이그레이션 파일 정리
  - [ ] 마이그레이션 순서 재정렬  
  - [ ] 테이블 관계 최적화

---

## 🟡 P2 체크리스트 (분기별 계획)

### 1분기: 품질 및 모니터링
- [ ] **테스트 자동화** (4주)
  - [ ] 주차 1: 프론트엔드 단위 테스트
  - [ ] 주차 2: 백엔드 단위 테스트
  - [ ] 주차 3: 통합 테스트
  - [ ] 주차 4: E2E 테스트

- [ ] **모니터링 시스템** (2주)
  - [ ] 성능 모니터링 구축
  - [ ] 에러 추적 시스템  
  - [ ] 로깅 중앙화
  - [ ] 알림 시스템 설정

- [ ] **API 문서화** (2주)
  - [ ] OpenAPI 명세서 작성
  - [ ] Swagger UI 구축
  - [ ] API 테스트 케이스 작성

### 2분기: 사용자 경험
- [ ] **PWA 변환** (3주)
- [ ] **접근성 지원** (2주)  
- [ ] **모바일 최적화** (3주)
- [ ] **다국어 지원** (4주)

### 3분기: 아키텍처 혁신
- [ ] **마이크로서비스 설계** (6주)
- [ ] **캐싱 시스템** (2주)
- [ ] **API Gateway** (4주)

---

## 🟢 P3 체크리스트 (장기 계획)

### 6개월 이후
- [ ] **확장성 테스트**
  - [ ] 로드 테스트 (동시 사용자 1000명)
  - [ ] 스트레스 테스트 (피크 트래픽)
  - [ ] 장애 복구 테스트

- [ ] **고도화 기능**
  - [ ] AI/ML 기능 통합
  - [ ] 실시간 협업 강화
  - [ ] 고급 분석 기능

---

## 📊 실행 추적 대시보드

### 이번 주 진행률
```
🔴 P0 진행률: ░░░░░░░░░░ 0% (0/4 완료)
🟠 P1 진행률: ░░░░░░░░░░ 0% (0/5 완료)  
🟡 P2 진행률: ░░░░░░░░░░ 0% (0/8 완료)
🟢 P3 진행률: ░░░░░░░░░░ 0% (0/6 완료)
```

### 이번 달 목표
```
보안 패치 완료: ████████░░ 80%
성능 최적화: ██████░░░░ 60%  
테스트 커버리지: ████░░░░░░ 40%
문서화 개선: ███████░░░ 70%
```

---

## 🎯 실행 우선순위 최종 정리

### 🚨 이번 주 (반드시 완료)
1. **JWT Secret 보안 강화** (30분) - P0
2. **관리자 API 인증 추가** (2시간) - P0  
3. **약한 해싱 교체** (30분) - P0
4. **SQL Injection 방어** (1시간) - P0

### 📅 다음 주 (우선 진행)
1. **App.tsx 리팩토링 시작** (5일) - P1
2. **Rate Limiting 구현** (1일) - P1
3. **CORS 보안 강화** (1일) - P1

### 📆 이번 달 (계획 실행)
1. **번들 크기 최적화** (3일) - P1  
2. **DB 인덱스 최적화** (2일) - P1
3. **테스트 자동화 착수** (4주) - P2

### 🗓️ 분기별 (로드맵 실행)
- **1분기**: 품질/모니터링 강화
- **2분기**: 사용자 경험 개선
- **3분기**: 아키텍처 혁신

---

**우선순위 기준**: 보안 > 성능 > 품질 > 사용자경험 > 확장성  
**평가 주기**: 매주 진행률 검토, 매월 우선순위 재평가  
**성공 지표**: 전체 품질 점수 6.7/10 → 9.0/10 달성